(()=>{"use strict";var e,t,r={488:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cloudinaryConfig=void 0,t.cloudinaryConfig={api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET,secure:!0,cloud_name:process.env.CLOUDINARY_API_CLOUD_NAME}},285:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585),i=a(r(172));let u=class{commentService;constructor(e){this.commentService=e}createComment(e,t){const{author:r,comment:s,postId:o}=e.body;return r&&o&&s?this.commentService.uploadComment(e,t):t.status(400).json({message:"Author, Post ID and comment are required"})}getReplies(e,t){return e.params.id?this.commentService.getCommentReplies(e,t):t.status(400).json({message:"Id is required",error:!0})}like(e,t){const{userId:r,commentId:s}=e.body;return r&&s?this.commentService.likeComment(e,t):t.status(400).json({message:"user id and comment id are required",error:!0})}};u=s([(0,n.Service)(),o("design:paramtypes",[i.default])],u),t.default=u},485:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585),i=a(r(286));let u=class{groupService;constructor(e){this.groupService=e}create(e,t){return this.groupService.createGroup(e,t)}getGroupById(e,t){return e.query.id?this.groupService.getGroup(e,t):t.status(400).json({message:"id is required",error:!0})}allGroups(e){return this.groupService.getAllGroups(e)}joinOrLeave(e,t){return e.query.userId&&e.query.groupId?this.groupService.joinOrLeaveGroup(e,t):t.status(400).json({message:"Group ID and User ID are required"})}getAllGroupsWhereUserIn(e,t){return this.groupService.getGroupsWhereUserIsAdminOrMember(e,t)}};u=s([(0,n.Service)(),o("design:paramtypes",[i.default])],u),t.default=u},853:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585),i=a(r(586));let u=class{meetup;constructor(e){this.meetup=e}create(e,t){const{address:r,companyName:s,date:o,image:a,title:n,body:i,author:u,assetId:d,category:c}=e.body;return r&&s&&o&&n&&i&&u&&a&&d&&c?this.meetup.createMeetup(e,t):t.status(400).json({message:"Please provide values for all required fields.",error:!0})}allMeetups(e){return this.meetup.getAllMeetups(e)}getMeetupById(e,t){return e.query.id?this.meetup.getMeetup(e,t):t.status(400).json({message:"Id is required",error:!0})}};u=s([(0,n.Service)(),o("design:paramtypes",[i.default])],u),t.default=u},174:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585),i=a(r(399));let u=class{podcastService;constructor(e){this.podcastService=e}createPodcast(e,t){const{audio:r,audioAssetId:s,body:o,tags:a,postImage:n,title:i,author:u,postImageAssetId:d,category:c}=e.body;return r&&s&&o&&!(a.length<1)&&n&&i&&u&&d&&c&&c?this.podcastService.create(e,t):t.status(400).json({message:"Please provide all value for all required fields",error:!0})}getAll(e,t){return this.podcastService.getAllPodcasts(e,t)}getPodcast(e,t){return e.query.id?this.podcastService.getPodcastById(e,t):t.status(400).json({message:"id not provided",error:!0})}};u=s([(0,n.Service)(),o("design:paramtypes",[i.default])],u),t.default=u},347:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585),i=a(r(440));let u=class{postController;constructor(e){this.postController=e}create(e,t){const{title:r,body:s,image:o,assetId:a,category:n}=e.body;return r&&s&&o&&a&&n?this.postController.createPost(e,t):t.status(400).json({message:"Please fill all required fields",error:!0})}getPostById(e,t){return e.query.id?this.postController.getPost(e,t):t.status(400).json({message:"Id is required",error:!0})}allPosts(e,t){const{sort:r="popular",page:s=1}=e.query;return["newest","popular"].includes(r)?(s&&+s<1&&(e.query.page=1),this.postController.getAllPosts(e,t)):t.status(400).json({message:"Invalid sort options"})}updateView(e,t){const{postId:r}=e.body;return r?this.postController.incremementView(e,t):t.status(400).json({message:"Post Id is required"})}like(e,t){const{postId:r,userId:s}=e.body;return r&&s?this.postController.likePost(e,t):t.status(400).json({message:"post id and user id are required",error:!0})}relatedPosts(e,t){const{id:r,authorId:s}=e.query;return r&&s?this.postController.getRelatedPosts(e,t):t.status(400).json({message:"id and author id are required",error:!0})}share(e,t){const{postId:r}=e.body;return r?this.postController.sharePost(e,t):t.status(400).json({message:"Post Id is required",error:!0})}};u=s([(0,n.Service)(),o("design:paramtypes",[i.default])],u),t.default=u},644:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585),i=a(r(717));let u=class{userService;constructor(e){this.userService=e}create(e,t){const{email:r,id:s,password:o}=e.body;return r&&s&&o?this.userService.createUser(e,t):t.status(400).json({message:"Email,user id, username and password are required",error:!0}).end()}getUserById(e,t){return e.query.id?this.userService.getUser(e,t):t.status(400).json({message:"id is required",error:!0})}};u=s([(0,n.Service)(),o("design:paramtypes",[i.default])],u),t.default=u},607:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(236),(new(s(r(341)).default)).listen()},371:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static async validate(e,t,r){try{const s=e.headers.authorization?.split(" ")[1];return s?r():t.status(403).json({message:"Unauthorized",error:!0}).end()}catch(e){return t.status(500).json({message:"Internal Server Error",error:!0}).end()}}}},804:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),o=new s.Schema({author:{type:String,ref:"User"},comment:String,likes:[{type:String,ref:"User"}],postId:{type:s.Schema.Types.ObjectId,ref:"Post"},parentId:{type:s.Schema.Types.ObjectId,ref:"Comment",required:!1}},{timestamps:!0}),a=(0,s.model)("Comment",o);t.default=a},841:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),o=new s.Schema({name:{type:String,required:!0},banner:{type:String,required:!0},bannerAssetId:{type:String,required:!0},category:{type:String,required:!0},logo:{type:String,required:!0},logoAssetId:{type:String,required:!0},description:{type:String,required:!0},members:[{type:String,ref:"User"}],admins:[{type:String,ref:"User"}],tags:[String],posts:[{type:s.Schema.Types.ObjectId,ref:"Post"}]},{timestamps:!0}),a=(0,s.model)("Group",o);t.default=a},979:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),o=new s.Schema({title:{type:String,required:!0},category:{type:String,required:!0},image:{type:String,required:!0},assetId:{type:String,required:!0},address:{type:String,required:!0},companyName:{type:String,required:!0},date:{type:String,required:!0},body:{type:String,required:!0},tags:[{type:String,ref:"Tag"}],author:{type:String,ref:"User"}},{timestamps:!0}),a=(0,s.model)("Meetup",o);t.default=a},594:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),o=new s.Schema({audio:{type:String,required:!0},audioAssetId:{type:String,required:!0},author:{type:String,required:!0,ref:"User"},category:{type:String,required:!0},title:{type:String,required:!0},body:{type:String,required:!0},postImage:{type:String,required:!0},postImageAssetId:{type:String,required:!0},tags:[{type:s.Schema.Types.ObjectId,ref:"Tag"}]},{timestamps:!0}),a=(0,s.model)("Podcasts",o);t.default=a},435:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),o=new s.Schema({title:String,body:String,category:{type:String,required:!0},views:{type:Number,default:0},assetId:{type:String,required:!0},image:{type:String,required:!0},tags:[{type:s.Schema.Types.ObjectId,ref:"Tag"}],share:{type:Number,default:0},country:{type:String,required:!1},group:{type:s.Schema.Types.ObjectId,ref:"Group",required:!1},likes:[{type:String,ref:"User"}],comments:[{type:s.Schema.Types.ObjectId,ref:"Comment"}],author:{type:String,ref:"User"},report:[{type:s.Schema.Types.ObjectId,ref:"Report"}]},{timestamps:!0}),a=(0,s.model)("Post",o);t.default=a},152:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),o=new s.Schema({name:{type:String,unique:!0},postIds:[{type:s.Schema.Types.ObjectId,ref:"Post"}]}),a=(0,s.model)("Tag",o);t.default=a},805:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(185),o=new s.Schema({_id:{type:String,required:!0},username:{type:String,required:!0},password:{type:String,required:!0},email:{type:String,required:!0},region:{type:String,required:!0},country:{type:String,required:!0},profileImage:{type:String,required:!1},role:{type:String,required:!1,default:""},bio:{type:String,required:!1,default:""},website:{type:String,required:!1,default:""},followers:[{type:s.Schema.Types.ObjectId,ref:"User"}],followings:[{type:s.Schema.Types.ObjectId,ref:"User"}],posts:[{type:s.Schema.Types.ObjectId,ref:"Post"}],groups:[{type:s.Schema.Types.ObjectId,ref:"Group"}],groupMembers:[{type:s.Schema.Types.ObjectId,ref:"Group"}],meetups:[{type:s.Schema.Types.ObjectId,ref:"Meetup"}],podcasts:[{type:s.Schema.Types.ObjectId,ref:"Podcasts"}]},{timestamps:!0}),a=(0,s.model)("User",o);t.default=a},239:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(860),a=r(585),n=s(r(285)),i=s(r(804)),u=s(r(435)),d=(0,o.Router)();a.Container.set("CommentModel",i.default),a.Container.set("PostModel",u.default);const c=a.Container.get(n.default);d.get("/:id",((e,t)=>c.getReplies(e,t))),d.post("/create",((e,t)=>c.createComment(e,t))),d.post("/like",((e,t)=>c.like(e,t))),t.default=d},206:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(860),a=s(r(738)),n=s(r(871)),i=(0,o.Router)(),u=a.default.memoryStorage(),d=(0,a.default)({storage:u}),c=new n.default;i.post("/upload",d.single("file"),((e,t)=>c.upload(e,t))),t.default=i},990:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(585)),a=r(860),n=s(r(435)),i=s(r(152)),u=s(r(841)),d=s(r(644)),c=s(r(485)),l=(0,a.Router)();o.default.set("PostModel",n.default),o.default.set("Model",i.default),o.default.set("GroupModel",u.default),o.default.set("UserController",d.default);const p=o.default.get(c.default);l.post("/join",((e,t)=>p.joinOrLeave(e,t))),l.get("/all",((e,t)=>p.allGroups(t))),l.get("/",((e,t)=>p.getGroupById(e,t))),l.get("/group-member",((e,t)=>p.getAllGroupsWhereUserIn(e,t))),l.post("/create",((e,t)=>p.create(e,t))),t.default=l},935:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(860),a=s(r(585)),n=s(r(853)),i=s(r(805)),u=s(r(152)),d=s(r(979)),c=(0,o.Router)();a.default.set("UserModel",i.default),a.default.set("TagModel",u.default),a.default.set("MeetupModel",d.default);const l=a.default.get(n.default);c.get("/",((e,t)=>l.getMeetupById(e,t))),c.get("/all",((e,t)=>l.allMeetups(t))),c.post("/create",((e,t)=>l.create(e,t))),t.default=c},635:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(860),a=s(r(585)),n=s(r(174)),i=s(r(152)),u=s(r(594)),d=s(r(805)),c=(0,o.Router)();a.default.set("UserModel",d.default),a.default.set("PodcastModel",u.default),a.default.set("TagModel",i.default);const l=a.default.get(n.default);c.get("/all",((e,t)=>l.getAll(e,t))),c.post("/create",((e,t)=>l.createPodcast(e,t))),c.get("/",((e,t)=>l.getPodcast(e,t))),t.default=c},671:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(860),a=s(r(585)),n=s(r(347)),i=s(r(435)),u=s(r(152)),d=s(r(805)),c=s(r(841)),l=(0,o.Router)();a.default.set("PostModel",i.default),a.default.set("TagModel",u.default),a.default.set("UserModel",d.default),a.default.set("GroupModel",c.default);const p=a.default.get(n.default);l.post("/share",((e,t)=>p.share(e,t))),l.get("/related-posts",((e,t)=>p.relatedPosts(e,t))),l.post("/like",((e,t)=>p.like(e,t))),l.post("/increment-view",((e,t)=>p.updateView(e,t))),l.get("/all",((e,t)=>p.allPosts(e,t))),l.get("/",((e,t)=>p.getPostById(e,t))),l.post("/create",((e,t)=>p.create(e,t))),t.default=l},471:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(860),a=s(r(585)),n=s(r(644)),i=s(r(805)),u=s(r(371)),d=(0,o.Router)();a.default.set("UserModel",i.default);const c=a.default.get(n.default);d.post("/create",((e,t)=>c.create(e,t))),d.get("/",u.default.validate,((e,t)=>c.getUserById(e,t))),t.default=d},341:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),s(r(142)).default.config();const o=s(r(860)),a=s(r(582)),n=s(r(806)),i=s(r(455)),u=s(r(81)),d=s(r(471)),c=s(r(671)),l=s(r(239)),p=s(r(990)),f=s(r(935)),m=s(r(206)),g=s(r(635)),h=s(r(371));t.default=class{corsAllowUrl=process.env.CLIENT_URL;app;database=new u.default(process.env.DATABASE_URL);port=process.env.PORT||3e3;setCorsHeaders=(e,t,r)=>{t.setHeader("Access-Control-Allow-Origin",this.corsAllowUrl),t.setHeader("Access-Control-Allow-Methods","GET, POST, PATCH, PUT, DELETE"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),t.setHeader("Access-Control-Allow-Credentials","true"),r()};constructor(){this.app=(0,o.default)(),this.app.use((0,n.default)()),this.app.use(o.default.json()),this.app.use((0,a.default)({origin:process.env.CLIENT_URL,credentials:!0})),this.app.use(o.default.urlencoded({extended:!0})),this.app.use(this.setCorsHeaders),this.app.use((0,i.default)()),this.app.disable("x-powered-by"),this.app.get("/",((e,t)=>{t.json({message:"Hello from server"})})),this.app.use("/api/podcasts",g.default),this.app.use("/api",m.default),this.app.use("/api/user",d.default),this.app.use("/api/post",h.default.validate,c.default),this.app.use("/api/comment",h.default.validate,l.default),this.app.use("/api/group",h.default.validate,p.default),this.app.use("/api/meetup",h.default.validate,f.default)}listen(){this.app.listen(this.port,(async()=>{try{await this.database.connectToDb().then((()=>{console.log(`‚ö°Ô∏è[server]: Server is running at port ${this.port} `)}))}catch(e){console.error(`Failed to start server: ${e}`)}}))}connectDb(){return this.database.connectToDb()}}},172:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585);let i=class{commentModel;postModel;constructor(e,t){this.commentModel=e,this.postModel=t}async uploadComment(e,t){try{const{author:r,comment:s,postId:o,parentId:a}=e.body,n=await this.postModel.findById(o);if(!n)return t.status(404).json({message:"Post not found",error:!0}).end();const i=await this.commentModel.create({author:r,comment:s,postId:n.id,...a&&{parentId:a}});n.comments.push(i.id),await n.save(),t.status(200).json({message:"Comment uploaded",error:!1}).end()}catch(e){t.status(500).json({message:"Internal server error",error:!0}).end()}}async getCommentReplies(e,t){try{const r=await this.commentModel.find({parentId:e.params.id}).populate("author","username profileImage createdAt updateAt");return r.length<1?t.status(404).json({message:"Comment not found",error:!0}):t.status(200).json({data:r,error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async likeComment(e,t){const{userId:r,commentId:s}=e.body;try{const e=await this.commentModel.findById(s);if(!e)return t.status(404).json({message:"Comment not found",error:!0});const o=e.likes.indexOf(r);return-1!==o?e.likes.splice(o,1):e.likes.push(r),await e.save(),t.status(200).end()}catch(e){t.status(500).json({message:"Internal server error",error:!0}).end()}}};i=s([(0,n.Service)(),a(0,(0,n.Inject)("CommentModel")),a(1,(0,n.Inject)("PostModel")),o("design:paramtypes",[Object,Object])],i),t.default=i},81:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{databaseUrl;constructor(e){this.databaseUrl=e}async connectToDb(){try{const e=await Promise.resolve().then(r.t.bind(r,185,23));if(!this.databaseUrl)return new Error("Database url is required");await e.connect(this.databaseUrl),console.log("success connect to db üéâ")}catch(e){throw e}}}},871:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(r(518)),a=r(488);t.default=class{async upload(e,t){try{if(e.file){o.default.v2.config(a.cloudinaryConfig);const r=Buffer.from(e.file.buffer).toString("base64");let s="data:"+e.file.mimetype+";base64,"+r;const n=await o.default.v2.uploader.upload(s,{resource_type:"auto"});t.status(200).json({public_id:n.public_id,secure_url:n.secure_url}).end()}}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0})}}}},286:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(585),u=n(r(268)),d=n(r(717));let c=class{groupModel;tagModel;userService;constructor(e,t,r){this.groupModel=e,this.tagModel=t,this.userService=r}isAdmin(e,t){return e.findIndex((e=>t.includes(e)))}async createTagsForGroup(e,t){await new u.default(this.groupModel,this.tagModel).createTagIfExists(e,t)}async populateGroupFieldWithUsers(e,t,r){for(const s of e)await this.groupModel.findByIdAndUpdate(r,{$push:{[t]:s}}),"members"===t?await this.userService.updateGroupFields(s,"groupMembers",r):await this.userService.updateGroupFields(s,"groups",r)}async createGroup(e,t){try{const{admins:r,tags:s,members:o,banner:a,description:n,logo:i,name:d,bannerAssetId:c,logoAssetId:l,category:p}=e.body;if(-1!==this.isAdmin(r,o))return t.status(400).json({message:"The user cannot be both a regular member and an admin simultaneously.",error:!0});const f=await this.groupModel.create({banner:a,description:n,logo:i,name:d,bannerAssetId:c,logoAssetId:l,category:p});s&&s.length>=1&&await this.createTagsForGroup(s,f.id),await Promise.all([this.populateGroupFieldWithUsers(r,"admins",f._id),this.populateGroupFieldWithUsers(o,"members",f._id)]),s&&s.length>=1&&await new u.default(this.groupModel,this.tagModel).createTagIfExists(s,f.id),t.status(201).json({message:"Group has been created",error:!1}).end()}catch(e){e instanceof Error&&(console.log(e),t.status(500).json({message:e.message,error:!0}).end())}}async getGroup(e,t){try{const r=await this.groupModel.findById(e.query.id).populate({path:"posts",model:"Post",populate:[{path:"author",model:"User",select:"username _id profileImage"},{path:"group",model:"Group"},{path:"tags",model:"Tag"}]}).populate("admins","_id username profileImage").populate("members","_id username profileImage");return r?t.status(200).json({data:r,error:!1}):t.status(404).json({message:"Group not found",error:!0})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getAllGroups(e){try{const t=await this.groupModel.find({}).populate("admins","username _id profileImage").populate("members","username _id profileImage").populate("tags").populate({path:"posts",populate:[{path:"author",model:"User"},{path:"group",model:"Group"}]});return e.status(200).json({data:t,error:!1})}catch(t){t instanceof Error&&e.status(500).json({message:t.message,error:!0}).end()}}async joinOrLeaveGroup(e,t){try{const r=await this.groupModel.findById(e.query.groupId);if(!r)return t.status(404).json({message:"Group not found",error:!0}).end();const s=r.members.indexOf(e.query.userId);-1!==s?r.members.splice(s,1):r.members.push(e.query.userId),await r.save(),t.status(200).json({data:r,error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getGroupsWhereUserIsAdminOrMember(e,t){try{const r=await this.groupModel.find({$or:[{admins:{$in:[e.query.admins]}},{members:{$in:[e.query.members]}}]}).populate("admins","username");return t.json({data:r,error:!1})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}};c=s([(0,i.Service)(),a(0,(0,i.Inject)("GroupModel")),a(1,(0,i.Inject)("TagModel")),a(2,(0,i.Inject)((()=>d.default))),o("design:paramtypes",[Object,Object,d.default])],c),t.default=c},586:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(585),u=n(r(268));let d=class{meetupModel;tagModel;userModel;constructor(e,t,r){this.meetupModel=e,this.tagModel=t,this.userModel=r}async createMeetup(e,t){try{const{address:r,companyName:s,date:o,image:a,title:n,tags:i,body:d,author:c,assetId:l,category:p}=e.body,f=await this.userModel.findById(c);if(!f)return t.status(404).json({message:"User not found",error:!0});const m=await this.meetupModel.create({address:r,companyName:s,date:o,image:a,title:n,body:d,author:c,assetId:l,category:p});await new u.default(this.meetupModel,this.tagModel).createTagIfExists(i,m.id),f.meetups.push(m.id),await f.save(),t.status(201).json({data:m,error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message}).end()}}async getAllMeetups(e){try{const t=await this.meetupModel.find({}).populate("author","_id username profileImage createdAt");return e.status(200).json({data:t,error:!1})}catch(t){t instanceof Error&&e.status(500).json({message:t.message,error:!0}).end()}}async getMeetup(e,t){try{const r=await this.meetupModel.findById(e.query.id).populate("author");return r?t.status(200).json({data:r,error:!1}):t.status(404).json({message:"Meetup not found",error:!0})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}};d=s([(0,i.Service)(),a(0,(0,i.Inject)("MeetupModel")),a(1,(0,i.Inject)("TagModel")),a(2,(0,i.Inject)("UserModel")),o("design:paramtypes",[Object,Object,Object])],d),t.default=d},399:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(585),u=n(r(268));let d=class{podcastModel;userModel;tagModel;constructor(e,t,r){this.podcastModel=e,this.userModel=t,this.tagModel=r}async create(e,t){try{const{audio:r,audioAssetId:s,body:o,tags:a,postImage:n,title:i,author:d,postImageAssetId:c,category:l}=e.body,p=await this.userModel.findById(d);if(!p)return t.status(404).json({message:"User not found",error:!0});const f=await this.podcastModel.create({audio:r,audioAssetId:s,body:o,postImage:n,title:i,author:d,postImageAssetId:c,category:l});return a&&a.length>=1&&await new u.default(this.podcastModel,this.tagModel).createTagIfExists(a,f.id),p.podcasts.push(f.id),await p.save(),t.status(201).json({message:"Podcast has been published",error:!1})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getAllPodcasts(e,t){try{const{sort:r="popular",page:s=1,limit:o=10}=e.query;let a={};a="newest"===r?{createdAt:-1}:{createdAt:1};const[n,i]=await Promise.all([this.podcastModel.countDocuments(),this.podcastModel.find().populate("author","_id username profileImage region country").populate("tags").skip(((s?+s:1)-1)*+o).limit(+o).sort(a)]);t.status(200).json({error:!1,data:{totalPodcasts:n,allPodcasts:i}}).end()}catch(e){e instanceof Error&&t.json({message:e.message,error:!0}).end(),t.status(500).json({message:"Internal server error",error:!0}).end()}}async getPodcastById(e,t){try{const r=await this.podcastModel.findById(e.query.id).populate("author");return r?t.status(200).json({data:r,error:!1}):t.status(404).json({message:"Podcast not found",error:!0})}catch(e){e instanceof Error&&t.json({message:e.message,error:!0}).end(),t.status(500).json({message:"Internal server error",error:!0}).end()}}};d=s([(0,i.Service)(),a(0,(0,i.Inject)("PodcastModel")),a(1,(0,i.Inject)("UserModel")),a(2,(0,i.Inject)("TagModel")),o("design:paramtypes",[Object,Object,Object])],d),t.default=d},440:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(585),u=n(r(268)),d=n(r(57));let c=class{PostModel;tagModel;userModel;groupModel;constructor(e,t,r,s){this.PostModel=e,this.tagModel=t,this.userModel=r,this.groupModel=s}async createPost(e,t){try{const{title:r,body:s,image:o,author:a,tags:n,group:i,assetId:c,category:l}=e.body,p=await this.userModel.findById(a);if(!p)return t.status(404).json({message:"User not found",error:!0}).end();const f=await d.default.getUserCountry(),m=await this.PostModel.create({title:r,body:s,image:o,author:p,assetId:c,category:l,country:f.country_name,...i?{group:i}:{group:null}});if(p?.posts.push(m.id),await(p?.save()),n&&n.length>=1&&await new u.default(this.PostModel,this.tagModel).createTagIfExists(n,m.id),i){const e=await this.groupModel.findById(i);if(!e)return t.status(404).json({message:"Group not found",error:!0});e.posts.push(m.id),await e.save()}t.status(201).json({message:"Post has been created",error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getPost(e,t){try{const r=await this.PostModel.find({_id:e.query.id}).populate("author","username profileImage createdAt").populate("tags").populate({path:"comments",match:{parentId:{$exists:!1}},populate:{path:"author",select:{_id:1,username:1,profileImage:1}}});if(!r)return t.status(404).json({message:"Post not found",error:!0});t.json({data:r,error:!1}).end()}catch(e){e instanceof Error&&t.json({message:e.message,error:!0}).end()}}async getAllPosts(e,t){try{const{sort:r="popular",page:s=1,limit:o=10}=e.query;let a={};a="newest"===r?{createdAt:-1}:{createdAt:1};const[n,i]=await Promise.all([this.PostModel.countDocuments(),this.PostModel.find({group:null}).populate("author","username profileImage createdAt").populate("tags").skip(((s?+s:1)-1)*+o).limit(+o).sort(a)]);t.status(200).json({error:!1,data:i,totalPosts:n}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async incremementView(e,t){try{const{postId:r}=e.body;if(!this.PostModel.findById(r))return t.status(404).json({message:"Post not found",error:!0});await this.PostModel.findByIdAndUpdate(r,{$inc:{views:1}}),t.status(200).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async likePost(e,t){const{postId:r,userId:s}=e.body;try{const[e,o]=await Promise.all([this.PostModel.findById(r),this.userModel.findById(s)]);if(!o||!e)return t.status(404).json({message:"User or Post not found",error:!0});const a=e.likes.indexOf(o.id);-1!==a?e.likes.splice(a,1):e.likes.push(o.id),await e.save(),t.status(200).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getRelatedPosts(e,t){const{id:r,authorId:s}=e.query;try{const e=await this.PostModel.find({author:s,group:null}).populate("tags");t.status(200).json(e.filter((e=>e._id.toString()!==r))).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async sharePost(e,t){try{const{postId:r}=e.body,s=await this.PostModel.findById(r);if(!s)return t.status(404).json({message:"Post not found",error:!0});await this.PostModel.findByIdAndUpdate(s._id,{$inc:{share:1}}),t.status(200).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}};c=s([(0,i.Service)(),a(0,(0,i.Inject)("PostModel")),a(1,(0,i.Inject)("TagModel")),a(2,(0,i.Inject)("UserModel")),a(3,(0,i.Inject)("GroupModel")),o("design:paramtypes",[Object,Object,Object,Object])],c),t.default=c},268:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(585);let i=class{model;tagModel;constructor(e,t){this.model=e,this.tagModel=t}async createTagIfExists(e,t){try{const r=[];for(const s of e){const[e]=await Promise.all([this.tagModel.findOneAndUpdate({name:s},{$setOnInsert:{name:s},$push:{postIds:t}},{upsert:!0,new:!0})]);r.push(e.id)}return await this.model.findByIdAndUpdate(t,{tags:r}),r}catch(e){throw e}}};i=s([(0,n.Service)(),a(0,(0,n.Inject)("Model")),a(1,(0,n.Inject)("TagModel")),o("design:paramtypes",[Object,Object])],i),t.default=i},717:function(e,t,r){var s=this&&this.__decorate||function(e,t,r,s){var o,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(n=(a<3?o(n):a>3?o(t,r,n):o(t,r))||n);return a>3&&n&&Object.defineProperty(t,r,n),n},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(r,s){t(r,s,e)}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(585),u=n(r(96)),d=n(r(57));let c=class{userModel;constructor(e){this.userModel=e}async createUser(e,t){try{const{email:r,id:s,image:o,password:a,username:n}=e.body,i=await d.default.getUserCountry();u.default.hash(a,10,(async(e,a)=>e?t.status(400).json({message:"Failed to hash password",error:!0}):(await this.userModel.create({email:r,...o&&{profileImage:o},_id:s,password:a,username:n,country:i.country_name,region:i.region}),t.status(201).json({message:"User created",error:!1}).end())))}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getUser(e,t){try{const r=await this.userModel.findById(e.query.id).populate({path:"posts",populate:{path:"author"}}).populate("groups").populate("meetups").populate({path:"podcasts",populate:{path:"author"}});if(!r)return t.status(404).json({message:"User not found",error:!0});t.json({data:r,error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async updateGroupFields(e,t,r){try{const s=await this.userModel.findById(e);if(!s)throw new Error("User not found");s[t].push(r),await s.save()}catch(e){throw e}}};c=s([(0,i.Service)(),a(0,(0,i.Inject)("UserModel")),o("design:paramtypes",[Object])],c),t.default=c},57:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static async getUserCountry(){try{const e=await fetch("https://api.ipify.org/?format=json"),{ip:t}=await e.json(),r=await fetch(`https://ipapi.co/${t}/json/`);return await r.json()}catch(e){throw e}}}},96:e=>{e.exports=require("bcrypt")},518:e=>{e.exports=require("cloudinary")},455:e=>{e.exports=require("compression")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},806:e=>{e.exports=require("helmet")},185:e=>{e.exports=require("mongoose")},738:e=>{e.exports=require("multer")},236:e=>{e.exports=require("reflect-metadata")},585:e=>{e.exports=require("typedi")}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return r[e].call(a.exports,a,a.exports,o),a.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"==typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"==typeof r.then)return r}var a=Object.create(null);o.r(a);var n={};e=e||[null,t({}),t([]),t(t)];for(var i=2&s&&r;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>n[e]=()=>r[e]));return n.default=()=>r,o.d(a,n),a},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a=o(607),n=exports;for(var i in a)n[i]=a[i];a.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();