(()=>{"use strict";var e,t,s={488:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cloudinaryConfig=void 0,t.cloudinaryConfig={api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET,secure:!0,cloud_name:process.env.CLOUDINARY_API_CLOUD_NAME}},285:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{commentService;constructor(e){this.commentService=e,this.commentService=e}createComment(e,t){const{author:s,comment:r,postId:o}=e.body;return s&&o&&r?this.commentService.uploadComment(e,t):t.status(400).json({message:"Author, Post ID and comment are required"})}getReplies(e,t){return e.params.id?this.commentService.getCommentReplies(e,t):t.status(400).json({message:"Id is required",error:!0})}like(e,t){const{userId:s,commentId:r}=e.body;return s&&r?this.commentService.likeComment(e,t):t.status(400).json({message:"user id and comment id are required",error:!0})}}},485:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{groupService;constructor(e){this.groupService=e}create(e,t){return this.groupService.createGroup(e,t)}getGroupById(e,t){return e.query.id?this.groupService.getGroup(e,t):t.status(400).json({message:"id is required",error:!0})}allGroups(e){return this.groupService.getAllGroups(e)}joinOrLeave(e,t){return e.query.userId&&e.query.groupId?this.groupService.joinOrLeaveGroup(e,t):t.status(400).json({message:"Group ID and User ID are required"})}getAllGroupsWhereUserIn(e,t){return this.groupService.getGroupsWhereUserIsAdminOrMember(e,t)}}},853:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{meetup;constructor(e){this.meetup=e}create(e,t){const{address:s,companyName:r,date:o,image:a,title:n,body:u,author:d,assetId:i,category:l}=e.body;return s&&r&&o&&n&&u&&d&&a&&i&&l?this.meetup.createMeetup(e,t):t.status(400).json({message:"Please provide values for all required fields.",error:!0})}allMeetups(e){return this.meetup.getAllMeetups(e)}getMeetupById(e,t){return e.query.id?this.meetup.getMeetup(e,t):t.status(400).json({message:"Id is required",error:!0})}}},174:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{podcastService;constructor(e){this.podcastService=e}createPodcast(e,t){const{audio:s,audioAssetId:r,body:o,tags:a,postImage:n,title:u,author:d,postImageAssetId:i,category:l}=e.body;return s&&r&&o&&!(a.length<1)&&n&&u&&d&&i&&l&&l?this.podcastService.create(e,t):t.status(400).json({message:"Please provide all value for all required fields",error:!0})}getAll(e,t){return this.podcastService.getAllPodcasts(e,t)}getPodcast(e,t){return e.query.id?this.podcastService.getPodcastById(e,t):t.status(400).json({message:"id not provided",error:!0})}}},347:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{postController;constructor(e){this.postController=e}create(e,t){const{title:s,body:r,image:o,assetId:a,category:n}=e.body;return s&&r&&o&&a&&n?this.postController.createPost(e,t):t.status(400).json({message:"Please fill all required fields",error:!0})}getPostById(e,t){return e.query.id?this.postController.getPost(e,t):t.status(400).json({message:"Id is required",error:!0})}allPosts(e,t){const{sort:s="popular",page:r=1}=e.query;return["newest","popular"].includes(s)?(r&&+r<1&&(e.query.page=1),this.postController.getAllPosts(e,t)):t.status(400).json({message:"Invalid sort options"})}updateView(e,t){const{postId:s}=e.body;return s?this.postController.incremementView(e,t):t.status(400).json({message:"Post Id is required"})}like(e,t){const{postId:s,userId:r}=e.body;return s&&r?this.postController.likePost(e,t):t.status(400).json({message:"post id and user id are required",error:!0})}relatedPosts(e,t){const{id:s,authorId:r}=e.query;return s&&r?this.postController.getRelatedPosts(e,t):t.status(400).json({message:"id and author id are required",error:!0})}share(e,t){const{postId:s}=e.body;return s?this.postController.sharePost(e,t):t.status(400).json({message:"Post Id is required",error:!0})}}},644:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{userService;constructor(e){this.userService=e}create(e,t){const{email:s,id:r,password:o}=e.body;return s&&r&&o?this.userService.createUser(e,t):t.status(400).json({message:"Email,user id, username and password are required",error:!0}).end()}getUserById(e,t){return e.query.id?this.userService.getUser(e,t):t.status(400).json({message:"id is required",error:!0})}}},607:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),(new(r(s(341)).default)).listen()},371:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static async validate(e,t,s){try{const r=e.headers.authorization?.split(" ")[1];return r?s():t.status(403).json({message:"Unauthorized",error:!0}).end()}catch(e){return t.status(500).json({message:"Internal Server Error",error:!0}).end()}}}},804:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(185),o=new r.Schema({author:{type:String,ref:"User"},comment:String,likes:[{type:String,ref:"User"}],postId:{type:r.Schema.Types.ObjectId,ref:"Post"},parentId:{type:r.Schema.Types.ObjectId,ref:"Comment",required:!1}},{timestamps:!0}),a=(0,r.model)("Comment",o);t.default=a},841:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(185),o=new r.Schema({name:{type:String,required:!0},banner:{type:String,required:!0},bannerAssetId:{type:String,required:!0},category:{type:String,required:!0},logo:{type:String,required:!0},logoAssetId:{type:String,required:!0},description:{type:String,required:!0},members:[{type:String,ref:"User"}],admins:[{type:String,ref:"User"}],tags:[String],posts:[{type:r.Schema.Types.ObjectId,ref:"Post"}]},{timestamps:!0}),a=(0,r.model)("Group",o);t.default=a},979:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(185),o=new r.Schema({title:{type:String,required:!0},category:{type:String,required:!0},image:{type:String,required:!0},assetId:{type:String,required:!0},address:{type:String,required:!0},companyName:{type:String,required:!0},date:{type:String,required:!0},body:{type:String,required:!0},tags:[{type:String,ref:"Tag"}],author:{type:String,ref:"User"}},{timestamps:!0}),a=(0,r.model)("Meetup",o);t.default=a},594:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(185),o=new r.Schema({audio:{type:String,required:!0},audioAssetId:{type:String,required:!0},author:{type:String,required:!0,ref:"User"},category:{type:String,required:!0},title:{type:String,required:!0},body:{type:String,required:!0},postImage:{type:String,required:!0},postImageAssetId:{type:String,required:!0},tags:[{type:r.Schema.Types.ObjectId,ref:"Tag"}]},{timestamps:!0}),a=(0,r.model)("Podcasts",o);t.default=a},435:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(185),o=new r.Schema({title:String,body:String,category:{type:String,required:!0},views:{type:Number,default:0},assetId:{type:String,required:!0},image:{type:String,required:!0},tags:[{type:r.Schema.Types.ObjectId,ref:"Tag"}],share:{type:Number,default:0},country:{type:String,required:!1},group:{type:r.Schema.Types.ObjectId,ref:"Group",required:!1},likes:[{type:String,ref:"User"}],comments:[{type:r.Schema.Types.ObjectId,ref:"Comment"}],author:{type:String,ref:"User"},report:[{type:r.Schema.Types.ObjectId,ref:"Report"}]},{timestamps:!0}),a=(0,r.model)("Post",o);t.default=a},152:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(185),o=new r.Schema({name:{type:String,unique:!0},postIds:[{type:r.Schema.Types.ObjectId,ref:"Post"}]}),a=(0,r.model)("Tag",o);t.default=a},805:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(185),o=new r.Schema({_id:{type:String,required:!0},username:{type:String,required:!0},password:{type:String,required:!0},email:{type:String,required:!0},region:{type:String,required:!0},country:{type:String,required:!0},points:{type:Number,default:0},profileImage:{type:String,required:!1},role:{type:String,required:!1,default:""},bio:{type:String,required:!1,default:""},website:{type:String,required:!1,default:""},followers:[{type:r.Schema.Types.ObjectId,ref:"User"}],followings:[{type:r.Schema.Types.ObjectId,ref:"User"}],posts:[{type:r.Schema.Types.ObjectId,ref:"Post"}],groups:[{type:r.Schema.Types.ObjectId,ref:"Group"}],groupMembers:[{type:r.Schema.Types.ObjectId,ref:"Group"}],meetups:[{type:r.Schema.Types.ObjectId,ref:"Meetup"}],podcasts:[{type:r.Schema.Types.ObjectId,ref:"Podcasts"}]},{timestamps:!0}),a=(0,r.model)("User",o);t.default=a},239:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(860),a=r(s(285)),n=r(s(804)),u=r(s(435)),d=r(s(172)),i=(0,o.Router)(),l=new d.default(n.default,u.default),c=new a.default(l);i.get("/:id",((e,t)=>c.getReplies(e,t))),i.post("/create",((e,t)=>c.createComment(e,t))),i.post("/like",((e,t)=>c.like(e,t))),t.default=i},206:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(860),a=r(s(738)),n=r(s(871)),u=(0,o.Router)(),d=a.default.memoryStorage(),i=(0,a.default)({storage:d}),l=new n.default;u.post("/upload",i.single("file"),((e,t)=>l.upload(e,t))),t.default=u},990:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(860),a=r(s(152)),n=r(s(841)),u=r(s(485)),d=r(s(805)),i=r(s(286)),l=(0,o.Router)(),c=new i.default(n.default,a.default,d.default),p=new u.default(c);l.post("/join",((e,t)=>p.joinOrLeave(e,t))),l.get("/all",((e,t)=>p.allGroups(t))),l.get("/",((e,t)=>p.getGroupById(e,t))),l.get("/group-member",((e,t)=>p.getAllGroupsWhereUserIn(e,t))),l.post("/create",((e,t)=>p.create(e,t))),t.default=l},935:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(860),a=r(s(853)),n=r(s(805)),u=r(s(152)),d=r(s(979)),i=r(s(586)),l=(0,o.Router)(),c=new i.default(d.default,u.default,n.default),p=new a.default(c);l.get("/",((e,t)=>p.getMeetupById(e,t))),l.get("/all",((e,t)=>p.allMeetups(t))),l.post("/create",((e,t)=>p.create(e,t))),t.default=l},635:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(860),a=r(s(174)),n=r(s(152)),u=r(s(594)),d=r(s(805)),i=r(s(399)),l=(0,o.Router)(),c=new i.default(u.default,d.default,n.default),p=new a.default(c);l.get("/all",((e,t)=>p.getAll(e,t))),l.post("/create",((e,t)=>p.createPodcast(e,t))),l.get("/",((e,t)=>p.getPodcast(e,t))),t.default=l},671:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(860),a=r(s(347)),n=r(s(435)),u=r(s(152)),d=r(s(805)),i=r(s(841)),l=r(s(440)),c=(0,o.Router)(),p=new l.default(n.default,u.default,d.default,i.default),m=new a.default(p);c.post("/share",((e,t)=>m.share(e,t))),c.get("/related-posts",((e,t)=>m.relatedPosts(e,t))),c.post("/like",((e,t)=>m.like(e,t))),c.post("/increment-view",((e,t)=>m.updateView(e,t))),c.get("/all",((e,t)=>m.allPosts(e,t))),c.get("/",((e,t)=>m.getPostById(e,t))),c.post("/create",((e,t)=>m.create(e,t))),t.default=c},471:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=s(860),a=r(s(644)),n=r(s(805)),u=r(s(371)),d=r(s(717)),i=(0,o.Router)(),l=new d.default(n.default),c=new a.default(l);i.post("/create",((e,t)=>c.create(e,t))),i.get("/",u.default.validate,((e,t)=>c.getUserById(e,t))),t.default=i},341:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(s(142)).default.config();const o=r(s(860)),a=r(s(582)),n=r(s(806)),u=r(s(455)),d=r(s(81)),i=r(s(471)),l=r(s(671)),c=r(s(239)),p=r(s(990)),m=r(s(935)),f=r(s(206)),g=r(s(635)),h=r(s(371));t.default=class{corsAllowUrl=process.env.CLIENT_URL;app;database=new d.default(process.env.DATABASE_URL);port=process.env.PORT||3e3;setCorsHeaders=(e,t,s)=>{t.setHeader("Access-Control-Allow-Origin",this.corsAllowUrl),t.setHeader("Access-Control-Allow-Methods","GET, POST, PATCH, PUT, DELETE"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),t.setHeader("Access-Control-Allow-Credentials","true"),s()};constructor(){this.app=(0,o.default)(),this.app.use((0,n.default)()),this.app.use(o.default.json()),this.app.use((0,a.default)({origin:process.env.CLIENT_URL,credentials:!0})),this.app.use(o.default.urlencoded({extended:!0})),this.app.use(this.setCorsHeaders),this.app.use((0,u.default)()),this.app.disable("x-powered-by"),this.app.use("/api/podcasts",g.default),this.app.use("/api",f.default),this.app.use("/api/user",i.default),this.app.use("/api/post",h.default.validate,l.default),this.app.use("/api/comment",h.default.validate,c.default),this.app.use("/api/group",h.default.validate,p.default),this.app.use("/api/meetup",h.default.validate,m.default)}listen(){this.app.listen(this.port,(async()=>{try{await this.database.connectToDb().then((()=>{console.log(`⚡️[server]: Server is running at port ${this.port} `)}))}catch(e){console.error(`Failed to start server: ${e}`)}}))}connectDb(){return this.database.connectToDb()}}},172:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{commentModel;postModel;constructor(e,t){this.commentModel=e,this.postModel=t}async uploadComment(e,t){try{const{author:s,comment:r,postId:o,parentId:a}=e.body,n=await this.postModel.findById(o);if(!n)return t.status(404).json({message:"Post not found",error:!0}).end();const u=await this.commentModel.create({author:s,comment:r,postId:n.id,...a&&{parentId:a}});return n.comments.push(u.id),await n.save(),t.json({message:"Comment uploaded",error:!1})}catch(e){t.status(500).json({message:"Internal server error",error:!0}).end()}}async getCommentReplies(e,t){try{const s=await this.commentModel.find({parentId:e.params.id}).populate("author","username profileImage createdAt updateAt");return s.length<1?t.status(404).json({message:"Comment not found",error:!0}):(t.setHeader("Cache-Control","public, max-age=3600"),t.status(200).json({data:s,error:!1}).end())}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async likeComment(e,t){const{userId:s,commentId:r}=e.body;try{const e=await this.commentModel.findById(r);if(!e)return t.status(404).json({message:"Comment not found",error:!0});const o=e.likes.indexOf(s);return-1!==o?e.likes.splice(o,1):e.likes.push(s),await e.save(),t.status(200).end()}catch(e){t.status(500).json({message:"Internal server error",error:!0}).end()}}}},81:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{databaseUrl;constructor(e){this.databaseUrl=e}async connectToDb(){try{const e=await Promise.resolve().then(s.t.bind(s,185,23));if(!this.databaseUrl)return new Error("Database url is required");await e.connect(this.databaseUrl),console.log("success connect to db 🎉")}catch(e){throw e}}}},871:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(518)),a=s(488);t.default=class{async upload(e,t){try{if(e.file){o.default.v2.config(a.cloudinaryConfig);const s=Buffer.from(e.file.buffer).toString("base64");let r="data:"+e.file.mimetype+";base64,"+s;const n=await o.default.v2.uploader.upload(r,{resource_type:"auto"});t.status(200).json({public_id:n.public_id,secure_url:n.secure_url}).end()}}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0})}}}},286:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(268)),a=r(s(717));t.default=class{groupModel;tagModel;userModel;constructor(e,t,s){this.groupModel=e,this.tagModel=t,this.userModel=s}isAdmin(e,t){return e.findIndex((e=>t.includes(e)))}async createTagsForGroup(e,t){await new o.default(this.groupModel,this.tagModel).createTagIfExists(e,t)}async populateGroupFieldWithUsers(e,t,s){for(const r of e){await this.groupModel.findByIdAndUpdate(s,{$push:{[t]:r}});const e=new a.default(this.userModel);"members"===t?await e.updateGroupFields(r,"groupMembers",s):await e.updateGroupFields(r,"groups",s)}}async createGroup(e,t){try{const{admins:s,tags:r,members:a,banner:n,description:u,logo:d,name:i,bannerAssetId:l,logoAssetId:c,category:p}=e.body;if(-1!==this.isAdmin(s,a))return t.status(400).json({message:"The user cannot be both a regular member and an admin simultaneously.",error:!0});const m=await this.groupModel.create({banner:n,description:u,logo:d,name:i,bannerAssetId:l,logoAssetId:c,category:p});await this.userModel.findByIdAndUpdate(s[0],{$inc:{points:5}}),r&&r.length>=1&&await this.createTagsForGroup(r,m.id),await Promise.all([this.populateGroupFieldWithUsers(s,"admins",m._id),this.populateGroupFieldWithUsers(a,"members",m._id)]),r&&r.length>=1&&await new o.default(this.groupModel,this.tagModel).createTagIfExists(r,m.id),t.status(201).json({message:"Group has been created",error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getGroup(e,t){try{const s=await this.groupModel.findById(e.query.id).populate({path:"posts",model:"Post",populate:[{path:"author",model:"User",select:"username _id profileImage"},{path:"group",model:"Group"},{path:"tags",model:"Tag"}]}).populate("admins","_id username profileImage").populate("members","_id username profileImage");return s?(t.setHeader("Cache-Control","public, max-age=3600"),t.json({data:s,error:!1})):t.status(404).json({message:"Group not found",error:!0})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getAllGroups(e){try{const t=await this.groupModel.find({}).populate("admins","username _id profileImage").populate("members","username _id profileImage").populate("tags").populate({path:"posts",populate:[{path:"author",model:"User"},{path:"group",model:"Group"}]});return e.setHeader("Cache-Control","public, max-age=3600"),e.status(200).json({data:t,error:!1})}catch(t){t instanceof Error&&e.status(500).json({message:t.message,error:!0}).end()}}async joinOrLeaveGroup(e,t){try{const s=await this.groupModel.findById(e.query.groupId);if(!s)return t.status(404).json({message:"Group not found",error:!0}).end();const r=s.members.indexOf(e.query.userId);-1!==r?s.members.splice(r,1):s.members.push(e.query.userId),await s.save(),t.status(200).json({data:s,error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getGroupsWhereUserIsAdminOrMember(e,t){try{const s=await this.groupModel.find({$or:[{admins:{$in:[e.query.admins]}},{members:{$in:[e.query.members]}}]}).populate("admins","username");return t.json({data:s,error:!1})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}}},586:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(268));t.default=class{meetupModel;tagModel;userModel;constructor(e,t,s){this.meetupModel=e,this.tagModel=t,this.userModel=s}async createMeetup(e,t){try{const{address:s,companyName:r,date:a,image:n,title:u,tags:d,body:i,author:l,assetId:c,category:p}=e.body,m=await this.userModel.findById(l);if(!m)return t.status(404).json({message:"User not found",error:!0});const f=await this.meetupModel.create({address:s,companyName:r,date:a,image:n,title:u,body:i,author:l,assetId:c,category:p});await new o.default(this.meetupModel,this.tagModel).createTagIfExists(d,f.id),m.meetups.push(f.id),m.points+=5,await m.save(),t.status(201).json({data:f,error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message}).end()}}async getAllMeetups(e){try{const t=await this.meetupModel.find({}).populate("author","_id username profileImage createdAt");return e.status(200).json({data:t,error:!1})}catch(t){t instanceof Error&&e.status(500).json({message:t.message,error:!0}).end()}}async getMeetup(e,t){try{const s=await this.meetupModel.findById(e.query.id).populate("author");return s?(t.setHeader("Cache-Control","public, max-age=3600"),t.status(200).json({data:s,error:!1})):t.status(404).json({message:"Meetup not found",error:!0})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}}},399:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(268));t.default=class{podcastModel;userModel;tagModel;constructor(e,t,s){this.podcastModel=e,this.userModel=t,this.tagModel=s}async create(e,t){try{const{audio:s,audioAssetId:r,body:a,tags:n,postImage:u,title:d,author:i,postImageAssetId:l,category:c}=e.body,p=await this.userModel.findById(i);if(!p)return t.status(404).json({message:"User not found",error:!0});const m=await this.podcastModel.create({audio:s,audioAssetId:r,body:a,postImage:u,title:d,author:i,postImageAssetId:l,category:c});return n&&n.length>=1&&await new o.default(this.podcastModel,this.tagModel).createTagIfExists(n,m.id),p.podcasts.push(m.id),p.points+=5,await p.save(),t.status(201).json({message:"Podcast has been published",error:!1})}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getAllPodcasts(e,t){try{const{sort:s="popular",page:r=1,limit:o=10}=e.query;let a={};a="newest"===s?{createdAt:-1}:{createdAt:1};const[n,u]=await Promise.all([this.podcastModel.countDocuments(),this.podcastModel.find().populate("author","_id username profileImage region country").populate("tags").skip(((r?+r:1)-1)*+o).limit(+o).sort(a)]);t.setHeader("Cache-Control","public, max-age=3600"),t.status(200).json({error:!1,data:{totalPodcasts:n,allPodcasts:u}}).end()}catch(e){e instanceof Error&&t.json({message:e.message,error:!0}).end(),t.status(500).json({message:"Internal server error",error:!0}).end()}}async getPodcastById(e,t){try{const s=await this.podcastModel.findById(e.query.id).populate("author");return s?(t.setHeader("Cache-Control","public, max-age=3600"),t.status(200).json({data:s,error:!1})):t.status(404).json({message:"Podcast not found",error:!0})}catch(e){e instanceof Error&&t.json({message:e.message,error:!0}).end(),t.status(500).json({message:"Internal server error",error:!0}).end()}}}},440:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(268)),a=r(s(57));t.default=class{PostModel;tagModel;userModel;groupModel;constructor(e,t,s,r){this.PostModel=e,this.tagModel=t,this.userModel=s,this.groupModel=r}async createPost(e,t){try{const{title:s,body:r,image:n,author:u,tags:d,group:i,assetId:l,category:c}=e.body,p=await this.userModel.findById(u);if(!p)return t.status(404).json({message:"User not found",error:!0}).end();const m=await a.default.getUserCountry(),f=await this.PostModel.create({title:s,body:r,image:n,author:p,assetId:l,category:c,country:m.country_name,...i?{group:i}:{group:null}});if(p?.posts.push(f.id),p.points+=5,await(p?.save()),d&&d.length>=1&&await new o.default(this.PostModel,this.tagModel).createTagIfExists(d,f.id),i){const e=await this.groupModel.findById(i);if(!e)return t.status(404).json({message:"Group not found",error:!0});e.posts.push(f.id),await e.save()}t.status(201).json({message:"Post has been created",error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getPost(e,t){try{const s=await this.PostModel.find({_id:e.query.id}).populate("author","username profileImage createdAt").populate("tags").populate({path:"comments",match:{parentId:{$exists:!1}},populate:{path:"author",select:{_id:1,username:1,profileImage:1}}});if(!s)return t.status(404).json({message:"Post not found",error:!0});t.json({data:s,error:!1}).end()}catch(e){e instanceof Error&&t.json({message:e.message,error:!0}).end()}}async getAllPosts(e,t){try{const{sort:s="popular",page:r=1,limit:o=10}=e.query;let a={};a="newest"===s?{createdAt:-1}:{createdAt:1};const[n,u]=await Promise.all([this.PostModel.countDocuments(),this.PostModel.find({group:null}).populate("author","username profileImage createdAt").populate("tags").skip(((r?+r:1)-1)*+o).limit(+o).sort(a)]);t.setHeader("Cache-Control","public, max-age=3600"),t.status(200).json({error:!1,data:u,totalPosts:n}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async incremementView(e,t){try{const{postId:s}=e.body;if(!this.PostModel.findById(s))return t.status(404).json({message:"Post not found",error:!0});await this.PostModel.findByIdAndUpdate(s,{$inc:{views:1}}),t.status(200).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async likePost(e,t){const{postId:s,userId:r}=e.body;try{const[e,o]=await Promise.all([this.PostModel.findById(s),this.userModel.findById(r)]);if(!o||!e)return t.status(404).json({message:"User or Post not found",error:!0});const a=e.likes.indexOf(o.id);-1!==a?e.likes.splice(a,1):e.likes.push(o.id),await e.save(),t.status(200).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getRelatedPosts(e,t){const{id:s,authorId:r}=e.query;try{const e=await this.PostModel.find({author:r,group:null}).limit(4).populate("tags");t.setHeader("Cache-Control","public, max-age=3600"),t.status(200).json(e.filter((e=>e._id.toString()!==s))).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async sharePost(e,t){try{const{postId:s}=e.body,r=await this.PostModel.findById(s);if(!r)return t.status(404).json({message:"Post not found",error:!0});await this.PostModel.findByIdAndUpdate(r._id,{$inc:{share:1}}),t.status(200).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}}},268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{model;tagModel;constructor(e,t){this.model=e,this.tagModel=t}async createTagIfExists(e,t){try{const s=[];for(const r of e){const[e]=await Promise.all([this.tagModel.findOneAndUpdate({name:r},{$setOnInsert:{name:r},$push:{postIds:t}},{upsert:!0,new:!0})]);s.push(e.id)}return await this.model.findByIdAndUpdate(t,{tags:s}),s}catch(e){throw e}}}},717:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(s(96)),a=r(s(57));t.default=class{userModel;constructor(e){this.userModel=e}async createUser(e,t){try{const{email:s,id:r,image:n,password:u,username:d}=e.body,i=await a.default.getUserCountry();o.default.hash(u,10,(async(e,o)=>e?t.status(400).json({message:"Failed to hash password",error:!0}):(await this.userModel.create({email:s,...n&&{profileImage:n},_id:r,password:o,username:d,country:i.country_name,region:i.region}),t.status(201).json({message:"User created",error:!1}).end())))}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async getUser(e,t){try{const s=await this.userModel.findById(e.query.id).populate({path:"posts",populate:{path:"author"}}).populate("groups").populate("meetups").populate({path:"podcasts",populate:{path:"author"}});if(!s)return t.status(404).json({message:"User not found",error:!0});t.json({data:s,error:!1}).end()}catch(e){e instanceof Error&&t.status(500).json({message:e.message,error:!0}).end()}}async updateGroupFields(e,t,s){try{const r=await this.userModel.findById(e);if(!r)throw new Error("User not found");r[t].push(s),await r.save()}catch(e){throw e}}}},57:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static async getUserCountry(){try{const e=await fetch("https://api.ipify.org/?format=json"),{ip:t}=await e.json(),s=await fetch(`https://ipapi.co/${t}/json/`);return await s.json()}catch(e){throw e}}}},96:e=>{e.exports=require("bcrypt")},518:e=>{e.exports=require("cloudinary")},455:e=>{e.exports=require("compression")},582:e=>{e.exports=require("cors")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},806:e=>{e.exports=require("helmet")},185:e=>{e.exports=require("mongoose")},738:e=>{e.exports=require("multer")}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var a=r[e]={exports:{}};return s[e].call(a.exports,a,a.exports,o),a.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(s,r){if(1&r&&(s=this(s)),8&r)return s;if("object"==typeof s&&s){if(4&r&&s.__esModule)return s;if(16&r&&"function"==typeof s.then)return s}var a=Object.create(null);o.r(a);var n={};e=e||[null,t({}),t([]),t(t)];for(var u=2&r&&s;"object"==typeof u&&!~e.indexOf(u);u=t(u))Object.getOwnPropertyNames(u).forEach((e=>n[e]=()=>s[e]));return n.default=()=>s,o.d(a,n),a},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a=o(607),n=exports;for(var u in a)n[u]=a[u];a.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();