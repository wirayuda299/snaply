(()=>{"use strict";var e,t,s,r,a,o={7097:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(s(5142)).default.config();const a=r(s(6860)),o=r(s(3582)),i=r(s(7806)),d=r(s(7455)),n=r(s(6371)),u=r(s(9081)),l=r(s(4471)),c=r(s(2671)),p=r(s(1239)),f=r(s(6990)),m=r(s(4935)),g=r(s(3761)),h=r(s(7635)),y=r(s(1206)),_=r(s(8428)),I=r(s(8453)),w=r(s(4237)),M=r(s(380));t.default=class{corsAllowUrl=process.env.CLIENT_URL;app;database=new u.default(process.env.DATABASE_URL);port=process.env.PORT||3e3;setCorsHeaders=(e,t,s)=>{t.setHeader("Access-Control-Allow-Origin",this.corsAllowUrl),t.setHeader("Access-Control-Allow-Methods","GET, POST, PATCH, PUT, DELETE"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),t.setHeader("Access-Control-Allow-Credentials","true"),s()};constructor(){this.app=(0,a.default)(),this.intializeMiddleware(),this.intializeRoutes()}listen(){this.app.listen(this.port,(async()=>{try{await this.database.connectToDb().then((()=>{console.log(`⚡️[server]: Server is running at port ${this.port} `)}))}catch(e){console.error(`Failed to start server: ${e}`)}}))}intializeMiddleware(){this.app.use((0,o.default)({origin:process.env.CLIENT_URL,credentials:!0})),this.app.use(a.default.json()),this.app.use((0,d.default)()),this.app.use(this.setCorsHeaders),this.app.use(a.default.urlencoded({extended:!0})),this.app.use((0,i.default)()),this.app.disable("x-powered-by")}intializeRoutes(){this.app.get("/",((e,t)=>{t.json({message:"Hello from server"}).end()})),this.app.use("/api/notification",n.default.validate,g.default),this.app.use("/api/podcasts",n.default.validate,h.default),this.app.use("/api",y.default),this.app.use("/api/user",l.default),this.app.use("/api/post",n.default.validate,c.default),this.app.use("/api/comment",n.default.validate,p.default),this.app.use("/api/group",n.default.validate,f.default),this.app.use("/api/meetup",n.default.validate,m.default),this.app.use("/api/tags",n.default.validate,_.default),this.app.use("/api/report",n.default.validate,I.default),this.app.use("/api/search",n.default.validate,w.default),this.app.use("/api/message",n.default.validate,M.default)}async connectDb(){return this.database.connectToDb()}}},1488:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cloudinaryConfig=void 0,r(s(5142)).default.config(),t.cloudinaryConfig={api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET,secure:!0,cloud_name:process.env.CLOUDINARY_API_CLOUD_NAME}},1805:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.client=void 0,r(s(5142)).default.config();const a=s(7902);t.client=new a.Redis({cache:"force-cache",url:process.env.REDIS_URL,token:process.env.REDIS_TOKEN,automaticDeserialization:!0})},1285:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{commentService;constructor(e){this.commentService=e}createComment(e,t){const{author:s,comment:r,postId:a}=e.body;return s&&a&&r?this.commentService.uploadComment(e,t):t.status(400).json({message:"Author, Post ID and comment are required"})}getReplies(e,t){return e.params.id?this.commentService.getCommentReplies(e,t):t.status(400).json({message:"Id is required",error:!0})}like(e,t){const{userId:s,commentId:r}=e.body;return s&&r?this.commentService.likeComment(e,t):t.status(400).json({message:"user id and comment id are required",error:!0})}}},4485:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{groupService;constructor(e){this.groupService=e}create(e,t){const{admins:s,tags:r,banner:a,description:o,logo:i,name:d,bannerAssetId:n,logoAssetId:u,category:l}=e.body;return!(s.length<1||r.length<1)&&a&&o&&i&&d&&n&&u&&l?this.groupService.createGroup(e,t):t.status(400).json({message:"Please provide all required value"})}getGroupById(e,t){return e.query.id?this.groupService.getGroup(e,t):t.status(400).json({message:"Group ID is required",error:!0})}allGroups(e){return this.groupService.getAllGroups(e)}join(e,t){const{groupId:s,userId:r}=e.body;return s&&r?this.groupService.joinGroup(e,t):t.status(400).json({message:"Group ID and User ID are required"})}leave(e,t){const{groupId:s,userId:r}=e.body;return s&&r?this.groupService.leaveGroup(e,t):t.status(400).json({message:"Group ID and User ID are required"})}getAllGroupsWhereUserIn(e,t){const{members:s,admins:r}=e.query;return s?.length<1&&r?.length<1?t.status(400).json({message:"admins and members is empty"}):this.groupService.getGroupsWhereUserIsAdminOrMember(e,t)}delete(e,t){const{groupId:s}=e.body;return s?t.status(400).json({message:"Group ID is required"}):this.groupService.deleteGroup(e,t)}update(e,t){const{groupId:s}=e.body;return s?t.status(400).json({message:"Group ID is required"}):this.groupService.updateGroup(e,t)}}},6853:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{meetup;constructor(e){this.meetup=e}create(e,t){const{address:s,companyName:r,date:a,image:o,title:i,body:d,author:n,assetId:u,category:l}=e.body;return s&&r&&a&&i&&d&&n&&o&&u&&l?this.meetup.createMeetup(e,t):t.status(400).json({message:"Please provide values for all required fields.",error:!0})}allMeetups(e,t){return this.meetup.getAllMeetups(e,t)}getMeetupById(e,t){return e.query.id?this.meetup.getMeetup(e,t):t.status(400).json({message:"Id is required",error:!0})}delete(e,t){return e.body.meetupId?t.status(400).json({message:"Meetup Id is required",error:!0}):this.meetup.deleteMeetup(e,t)}update(e,t){return e.body.meetupId?t.status(400).json({message:"Meetup Id is required",error:!0}):this.meetup.updateMeetup(e,t)}}},3246:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{messageService;constructor(e){this.messageService=e}create(e,t){const{members:s}=e.body;return s.length<2?t.status(400).json({message:"Member is less than 2"}):this.messageService.createConversation(e,t)}send(e,t){const{id:s,message:r,senderId:a,receiverId:o,messageId:i}=e.body;return s&&r&&a&&o&&i?this.messageService.sendMessage(e,t):t.status(400).json({message:"Please provide all required value"})}allConverstation(e,t){return this.messageService.getAllConversation(e,t)}chat(e,t){return e.query.id?this.messageService.getChat(e,t):t.status(400).json({message:"Id is required",error:!0})}unReadChat(e,t){const{receiverId:s}=e.query;return s?this.messageService.getUnreadChat(e,t):t.status(400).json({message:"ReceiverId is required",error:!0})}updateIsRead(e,t){const{messageId:s,senderId:r}=e.body;return s&&r?this.messageService.updateIsRead(e,t):t.status(400).json({message:"Sender ID and Message ID are required",error:!0})}}},6406:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{notificationService;constructor(e){this.notificationService=e}create(e,t){return this.notificationService.createNotification(e,t)}deleteNotification(e,t){const{type:s,postId:r,userId:a}=e.body;return s&&r&&a?this.notificationService.deleteNotification(e,t):t.status(400).json({message:"Type, Post ID and User ID are required"})}getAllNotifications(e,t){return this.notificationService.getAllNotification(e,t)}markAllAsRead(e,t){return this.notificationService.markAllAsRead(e,t)}}},4174:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{podcastService;constructor(e){this.podcastService=e}createPodcast(e,t){const{audio:s,audioAssetId:r,body:a,tags:o,postImage:i,title:d,author:n,postImageAssetId:u,category:l}=e.body;return s&&r&&a&&!(o.length<1)&&i&&d&&n&&u&&l&&l?this.podcastService.create(e,t):t.status(400).json({message:"Please provide all value for all required fields",error:!0})}getAll(e,t){return this.podcastService.getAllPodcasts(e,t)}getPodcast(e,t){return e.query.id?this.podcastService.getPodcastById(e,t):t.status(400).json({message:"id not provided",error:!0})}delete(e,t){return e.body.podcastId?this.podcastService.deletePodcast(e,t):t.status(400).json({message:"id not provided",error:!0})}}},3185:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{postService;constructor(e){this.postService=e}create(e,t){const{title:s,body:r,image:a,assetId:o,category:i}=e.body;return s&&r&&a&&o&&i?this.postService.createPost(e,t):t.status(400).json({message:"Please fill all required fields",error:!0})}getPostById(e,t){return e.query.id?this.postService.getPost(e,t):t.status(400).json({message:"Id is required",error:!0})}allPosts(e,t){const{sort:s="popular",page:r=1}=e.query;return["newest","popular"].includes(s)?(r&&+r<1&&(e.query.page=1),this.postService.getAllPosts(e,t)):t.status(400).json({message:"Invalid sort options"})}updateView(e,t){const{postId:s}=e.body;return s?this.postService.incremementView(e,t):t.status(400).json({message:"Post Id is required"})}like(e,t){const{postId:s,userId:r}=e.body;return s&&r?this.postService.likePost(e,t):t.status(400).json({message:"post id and user id are required",error:!0})}relatedPosts(e,t){const{id:s,authorId:r}=e.query;return s&&r?this.postService.getRelatedPosts(e,t):t.status(400).json({message:"id and author id are required",error:!0})}share(e,t){const{postId:s}=e.body;return s?this.postService.sharePost(e,t):t.status(400).json({message:"Post Id is required",error:!0})}deleteAPost(e,t){const{postId:s}=e.body;return s?this.postService.deletePost(e,t):t.status(400).json({message:"Post Id is required",error:!0})}update(e,t){const{postId:s}=e.body;return s?this.postService.updatePost(e,t):t.status(400).json({message:"Post Id is required",error:!0})}}},4631:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{reportService;constructor(e){this.reportService=e}reportPost(e,t){const{postId:s,reasons:r,userId:a}=e.body;return!s||r.length<1||!a?t.status(400).json({message:"All value is required"}):this.reportService.reportPost(e,t)}}},7782:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{_searchService;constructor(e){this._searchService=e}searchAll(e,t){const{searchTerm:s}=e.query;return s?this._searchService.search(e,t):t.status(400).json({message:"Please add search term",error:!0})}}},1548:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{tagService;constructor(e){this.tagService=e}getAllTags(e){return this.tagService.getAllTags(e)}}},644:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{userService;constructor(e){this.userService=e}create(e,t){const{email:s,id:r,password:a}=e.body;return s&&r&&a?this.userService.createUser(e,t):t.status(400).json({message:"Email,user id, username and password are required",error:!0}).end()}getUserById(e,t){return e.query.id?this.userService.getUser(e,t):t.status(400).json({message:"id is required",error:!0})}followUser(e,t){const{userId:s,followerId:r}=e.body;return s&&r?this.userService.handleFollow(e,t):t.status(400).json({message:"User ID and Follower ID is required",error:!0})}listAllUsers(e,t){return e.query.userId?this.userService.getAllUsers(e,t):t.status(400).end()}}},3607:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),(new(r(s(7097)).default)).listen()},6371:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static async validate(e,t,s){try{const r=e.headers.authorization?.split(" ")[1];return r?s():t.status(403).json({message:"Unauthorized",error:!0}).end()}catch(e){return t.status(500).json({message:"Internal Server Error",error:!0}).end()}}}},2804:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({author:{type:String,ref:"User"},comment:String,likes:[{type:String,ref:"User"}],postId:{type:r.Schema.Types.ObjectId,ref:"Post"},parentId:{type:r.Schema.Types.ObjectId,ref:"Comment",required:!1}},{timestamps:!0}),o=(0,r.model)("Comment",a);t.default=o},2841:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({name:{type:String,required:!0},banner:{type:String,required:!0},bannerAssetId:{type:String,required:!0},category:{type:String,required:!0},logo:{type:String,required:!0},logoAssetId:{type:String,required:!0},description:{type:String,required:!0},members:[{type:String,ref:"User"}],admins:[{type:String,ref:"User"}],tags:[{type:r.Schema.Types.ObjectId,ref:"Tag"}],posts:[{type:r.Schema.Types.ObjectId,ref:"Post"}]},{timestamps:!0});a.index({name:"text",category:"text"});const o=(0,r.model)("Group",a);t.default=o},7979:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({title:{type:String,required:!0},category:{type:String,required:!0},image:{type:String,required:!0},assetId:{type:String,required:!0},address:{type:String,required:!0},companyName:{type:String,required:!0},date:{type:String,required:!0},body:{type:String,required:!0},tags:[{type:r.Schema.Types.ObjectId,ref:"Tag"}],author:{type:String,ref:"User"}},{timestamps:!0});a.index({title:"text",companyName:"text"});const o=(0,r.model)("Meetup",a);t.default=o},6815:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.chatModel=void 0;const r=s(1185),a=new r.Schema({content:String,media:{image:{type:String,required:!1},imageAssetId:{type:String,required:!1},audio:{type:String,required:!1},audioAssetId:{type:String,required:!1},video:{type:String,required:!1},videoAssetId:{type:String,required:!1}},is_read:{type:Boolean,default:!1},senderId:{type:String,ref:"User"},receiverId:{type:String,ref:"User"},messageId:{type:String,ref:"message"}},{timestamps:!0});t.chatModel=(0,r.model)("Chat",a);const o=new r.Schema({members:[{type:String,ref:"User"}],messages:[{type:r.Schema.Types.ObjectId,ref:"Chat"}]},{timestamps:!0}),i=(0,r.model)("Message",o);t.default=i},6424:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({notificationType:{type:String,required:!0},message:String,to:{type:String,ref:"User"},from:{type:String,ref:"User"},is_read:{type:Boolean,default:!1},postId:{type:r.Schema.Types.ObjectId,required:!0},modelPath:String,comments:{type:String,required:!1}},{timestamps:!0}),o=(0,r.model)("Notification",a);t.default=o},2594:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({audio:{type:String,required:!0},audioAssetId:{type:String,required:!0},author:{type:String,required:!0,ref:"User"},category:{type:String,required:!0},title:{type:String,required:!0},body:{type:String,required:!0},postImage:{type:String,required:!0},postImageAssetId:{type:String,required:!0},tags:[{type:r.Schema.Types.ObjectId,ref:"Tag"}]},{timestamps:!0});a.index({title:"text"});const o=(0,r.model)("Podcasts",a);t.default=o},5435:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({title:String,body:String,category:{type:String,required:!0},views:{type:Number,default:0},assetId:{type:String,required:!0},image:{type:String,required:!0},tags:[{type:r.Schema.Types.ObjectId,ref:"Tag"}],share:{type:Number,default:0},country:{type:String,required:!1},group:{type:r.Schema.Types.ObjectId,ref:"Group",required:!1},likes:[{type:String,ref:"User"}],comments:[{type:r.Schema.Types.ObjectId,ref:"Comment"}],author:{type:String,ref:"User"},report:[{type:r.Schema.Types.ObjectId,ref:"Report"}]},{timestamps:!0});a.index({title:"text",body:"text"});const o=(0,r.model)("Post",a);t.default=o},8583:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({postId:r.Schema.Types.ObjectId,reasons:[String],reportBy:{type:String,ref:"User"}},{timestamps:!0}),o=(0,r.model)("Report",a);t.default=o},1152:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({name:{type:String,unique:!0},postIds:[{type:r.Schema.Types.ObjectId,ref:"Post"}]}),o=(0,r.model)("Tag",a);t.default=o},5805:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(1185),a=new r.Schema({_id:{type:String,required:!0},username:{type:String,required:!0},password:{type:String,required:!0},email:{type:String,required:!0},region:{type:String,required:!1},country:{type:String,required:!1},points:{type:Number,default:0},profileImage:{type:String,required:!1},role:{type:String,required:!1,default:""},bio:{type:String,required:!1,default:""},website:{type:String,required:!1,default:""},followers:[{type:String,ref:"User"}],followings:[{type:String,ref:"User"}],posts:[{type:r.Schema.Types.ObjectId,ref:"Post"}],groups:[{type:r.Schema.Types.ObjectId,ref:"Group"}],groupMembers:[{type:r.Schema.Types.ObjectId,ref:"Group"}],meetups:[{type:r.Schema.Types.ObjectId,ref:"Meetup"}],podcasts:[{type:r.Schema.Types.ObjectId,ref:"Podcasts"}],notifications:[{type:r.Schema.Types.ObjectId,ref:"Notification"}]},{timestamps:!0});a.index({_id:"text",username:"text",email:"text"});const o=(0,r.model)("User",a);t.default=o},9233:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.podcastQueue=void 0;const a=r(s(7068));t.podcastQueue=new a.default("podcastQueue",{redis:{host:"127.0.0.1",port:6379}})},1239:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(1285)),i=r(s(2804)),d=r(s(5435)),n=r(s(6172)),u=(0,a.Router)(),l=new n.default(i.default,d.default),c=new o.default(l);u.get("/:id",((e,t)=>c.getReplies(e,t))),u.post("/create",((e,t)=>c.createComment(e,t))),u.post("/like",((e,t)=>c.like(e,t))),t.default=u},1206:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(1738)),i=r(s(7871)),d=(0,a.Router)(),n=o.default.memoryStorage(),u=(0,o.default)({storage:n}),l=new i.default;d.post("/upload",u.single("file"),((e,t)=>l.upload(e,t))),t.default=d},6990:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(1152)),i=r(s(2841)),d=r(s(4485)),n=r(s(5805)),u=r(s(8286)),l=(0,a.Router)(),c=new u.default(i.default,o.default,n.default),p=new d.default(c);l.post("/join",((e,t)=>p.join(e,t))),l.post("/leave",((e,t)=>p.leave(e,t))),l.get("/all",((e,t)=>p.allGroups(t))),l.get("/",((e,t)=>p.getGroupById(e,t))),l.get("/group-member",((e,t)=>p.getAllGroupsWhereUserIn(e,t))),l.post("/create",((e,t)=>p.create(e,t))),l.post("/update",((e,t)=>p.update(e,t))),l.patch("/delete",((e,t)=>p.delete(e,t))),t.default=l},4935:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(1152)),i=r(s(5805)),d=r(s(7979)),n=r(s(3586)),u=r(s(6853)),l=(0,a.Router)(),c=new n.default(d.default,o.default,i.default),p=new u.default(c);l.get("/",((e,t)=>p.getMeetupById(e,t))),l.get("/all",((e,t)=>p.allMeetups(e,t))),l.post("/create",((e,t)=>p.create(e,t))),l.patch("/delete",((e,t)=>p.delete(e,t))),l.post("/update",((e,t)=>p.update(e,t))),t.default=l},380:function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var a=Object.getOwnPropertyDescriptor(t,s);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,a)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return a(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const d=s(6860),n=i(s(1820)),u=o(s(6815)),l=i(s(3246)),c=(0,d.Router)(),p=new n.default(u.default,u.chatModel),f=new l.default(p);c.post("/send",((e,t)=>f.send(e,t))),c.get("/all-conversation",((e,t)=>f.allConverstation(e,t))),c.get("/chat",((e,t)=>f.chat(e,t))),c.get("/unread-chat",((e,t)=>f.unReadChat(e,t))),c.post("/create",((e,t)=>f.create(e,t))),c.post("/update-is-read",((e,t)=>f.updateIsRead(e,t))),t.default=c},3761:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(6424)),i=r(s(5805)),d=r(s(6406)),n=r(s(5057)),u=(0,a.Router)(),l=new d.default(new n.default(o.default,i.default));u.post("/create",((e,t)=>l.create(e,t))),u.post("/delete",((e,t)=>l.deleteNotification(e,t))),u.post("/mark-as-read",((e,t)=>l.markAllAsRead(e,t))),u.get("/all-notifications",((e,t)=>l.getAllNotifications(e,t))),t.default=u},7635:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(4174)),i=r(s(1152)),d=r(s(2594)),n=r(s(5805)),u=r(s(8399)),l=(0,a.Router)(),c=new u.default(d.default,n.default,i.default),p=new o.default(c);l.get("/all",((e,t)=>p.getAll(e,t))),l.post("/create",((e,t)=>p.createPodcast(e,t))),l.get("/",((e,t)=>p.getPodcast(e,t))),l.patch("/delete",((e,t)=>p.delete(e,t))),t.default=l},2671:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(3185)),i=r(s(5435)),d=r(s(1152)),n=r(s(5805)),u=r(s(2841)),l=r(s(7440)),c=(0,a.Router)(),p=new l.default(i.default,d.default,n.default,u.default),f=new o.default(p);c.post("/share",((e,t)=>f.share(e,t))),c.get("/related-posts",((e,t)=>f.relatedPosts(e,t))),c.post("/like",((e,t)=>f.like(e,t))),c.post("/increment-view",((e,t)=>f.updateView(e,t))),c.get("/all",((e,t)=>f.allPosts(e,t))),c.get("/",((e,t)=>f.getPostById(e,t))),c.post("/create",((e,t)=>f.create(e,t))),c.patch("/delete",((e,t)=>f.deleteAPost(e,t))),c.post("/update",((e,t)=>f.update(e,t))),t.default=c},8453:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(1978)),i=r(s(8583)),d=r(s(5435)),n=r(s(4631)),u=(0,a.Router)(),l=new o.default(i.default,d.default),c=new n.default(l);u.post("/report-post",((e,t)=>c.reportPost(e,t))),t.default=u},4237:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(2580)),i=r(s(5435)),d=r(s(2841)),n=r(s(2594)),u=r(s(7782)),l=r(s(7979)),c=(0,a.Router)(),p=new o.default(l.default,i.default,d.default,n.default),f=new u.default(p);c.get("/all",((e,t)=>f.searchAll(e,t))),t.default=c},8428:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(1548)),i=r(s(1268)),d=r(s(5435)),n=r(s(1152)),u=(0,a.Router)(),l=new i.default(d.default,n.default),c=new o.default(l);u.get("/all-tags",((e,t)=>c.getAllTags(t))),t.default=u},4471:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(6860),o=r(s(6371)),i=r(s(5805)),d=r(s(6717)),n=r(s(644)),u=(0,a.Router)(),l=new d.default(i.default),c=new n.default(l);u.post("/create",((e,t)=>c.create(e,t))),u.get("/",o.default.validate,((e,t)=>c.getUserById(e,t))),u.get("/all-users",((e,t)=>c.listAllUsers(e,t))),u.post("/follow",o.default.validate,((e,t)=>c.followUser(e,t))),t.default=u},6172:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(8067),a=new(s(9251).RedisService);t.default=class{commentModel;postModel;constructor(e,t){this.commentModel=e,this.postModel=t}async uploadComment(e,t){try{const{author:s,comment:r,postId:o,parentId:i}=e.body,d=await this.postModel.findById(o);if(!d)return t.status(404).json({message:"Post not found",error:!0}).end();const n=await this.commentModel.create({author:s,comment:r,postId:d.id,...i&&{parentId:i}});return d.comments.push(n.id),await d.save(),await a.clearCacheSingle(`post:${o}`),t.json({message:"Comment uploaded",error:!1})}catch(s){(0,r.createError)(s,e,t,"upload-comment")}}async getCommentReplies(e,t){try{const s=await this.commentModel.find({parentId:e.params.id}).populate("author","username profileImage createdAt updateAt");return s?.length<1?t.status(404).json({message:"No replies yet",error:!0}):t.status(200).json({data:s,error:!1}).end()}catch(s){(0,r.createError)(s,e,t,"get-comment-replies")}}async likeComment(e,t){try{const{userId:s,commentId:r}=e.body,o=await this.commentModel.findById(r);if(!o)return t.status(404).json({message:"Comment not found",error:!0});const i=o.likes.indexOf(s);return-1!==i?o.likes.splice(i,1):o.likes.push(s),await o.save(),await a.clearCache("post"),t.status(200).end()}catch(s){(0,r.createError)(s,e,t,"like-comment")}}}},9081:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{databaseUrl;constructor(e){this.databaseUrl=e}async connectToDb(){try{const e=await Promise.resolve().then(s.t.bind(s,1185,23));if(!this.databaseUrl)throw new Error("Database url is required");await e.connect(this.databaseUrl,{retryWrites:!0,retryReads:!0}),console.log("success connect to db 🎉")}catch(e){throw e}}}},7871:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(s(3518)),o=s(1488),i=s(8067);t.default=class{async upload(e,t){try{if(e.file){a.default.v2.config(o.cloudinaryConfig);const s=Buffer.from(e.file.buffer).toString("base64");let r="data:"+e.file.mimetype+";base64,"+s;const i=await a.default.v2.uploader.upload(r,{resource_type:"auto"});t.status(200).json({error:!1,public_id:i.public_id,secure_url:i.secure_url,thumbnail:i.placeholder}).end()}}catch(s){(0,i.createError)(s,e,t,"file-upload")}}async deleteAsset(e,t){try{a.default.v2.config(o.cloudinaryConfig),await a.default.v2.uploader.destroy(e)}catch(e){(0,i.createError)(e,{},t,"asset-delete")}}}},8286:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(s(1268)),o=r(s(6717)),i=s(8067),d=r(s(7871)),n=s(9251),u=new n.RedisService;t.default=class{groupModel;tagModel;userModel;constructor(e,t,s){this.groupModel=e,this.tagModel=t,this.userModel=s}isAdmin(e,t){return e.findIndex((e=>t.includes(e)))}async createTagsForGroup(e,t){await new a.default(this.groupModel,this.tagModel).createTagIfExists(e,t)}async populateGroupFieldWithUsers(e,t,s){for(const r of e){await this.groupModel.findByIdAndUpdate(s,{$push:{[t]:r}});const e=new o.default(this.userModel);"members"===t?await e.updateGroupFields(r,"groupMembers",s):await e.updateGroupFields(r,"groups",s)}}async createGroup(e,t){try{const{admins:s,tags:r,members:a,banner:o,description:i,logo:d,name:n,bannerAssetId:l,logoAssetId:c,category:p}=e.body;if(-1!==this.isAdmin(s,a))return t.status(400).json({message:"The user cannot be both a regular member and an admin simultaneously.",error:!0});const f=await this.groupModel.create({banner:o,description:i,logo:d,name:n,bannerAssetId:l,logoAssetId:c,category:p});await this.userModel.findByIdAndUpdate(s[0],{$inc:{points:5}}),r&&r.length>=1&&await this.createTagsForGroup(r,f.id),await Promise.all([this.populateGroupFieldWithUsers(s,"admins",f._id),this.populateGroupFieldWithUsers(a,"members",f._id)]),await u.clearCache("groups"),t.status(201).json({message:"Group has been created",error:!1}).end()}catch(s){(0,i.createError)(s,e,t,"create-group")}}async getGroup(e,t){try{const s=await u.getOrCacheData(`group:${e.query.id}`,(async()=>await this.groupModel.findById(e.query.id).populate({path:"posts",model:"Post",populate:[{path:"author",model:"User",select:"username _id profileImage"},{path:"group",model:"Group"},{path:"tags",model:"Tag"}]}).populate("admins","_id username profileImage").populate("members","_id username profileImage").populate("tags")),t);return s?t.json({data:s,error:!1}):t.status(404).json({message:"Group not found",error:!0})}catch(s){(0,i.createError)(s,e,t,"get-group-by-id")}}async getAllGroups(e){try{const t=await(new n.RedisService).getOrCacheData("groups",(async()=>await this.groupModel.find({}).populate("admins","username _id profileImage").populate("members","username _id profileImage").populate("tags").populate({path:"posts",populate:[{path:"author",model:"User"},{path:"group",model:"Group"}]})),e);return e.status(200).json({data:t,error:!1})}catch(t){(0,i.createError)(t,req,e,"getAllGroups")}}async joinGroup(e,t){try{const{groupId:s,userId:r}=e.body,a=await this.groupModel.findById(s);if(!a)return t.status(404).json({message:"Group not found",error:!0}).end();if(-1!==a.members.indexOf(r))return t.status(400).json({message:"You already member of this group"});a.members.push(r),await a.save(),t.status(200).end()}catch(s){(0,i.createError)(s,e,t,"join-group")}}async leaveGroup(e,t){try{const{groupId:s,userId:r}=e.body,a=await this.groupModel.findById(s);if(!a)return t.status(404).json({message:"Group not found",error:!0}).end();const o=a.members.indexOf(r);if(-1===o)return t.status(400).json({message:"You are not member of this group"});a.members.splice(o,1),await a.save(),t.status(200).end()}catch(s){(0,i.createError)(s,e,t,"leave -group")}}async getGroupsWhereUserIsAdminOrMember(e,t){try{const s=await this.groupModel.find({$or:[{admins:{$in:[e.query.admins]}},{members:{$in:[e.query.members]}}]}).populate("admins","username");return t.json({data:s,error:!1})}catch(s){(0,i.createError)(s,e,t,"get-all-group-where-user-join")}}async deleteGroup(e,t){try{const s=await this.groupModel.findById(e.body.groupId);if(!s)return t.status(404).json({message:"Group not found",error:!0});if(s.admins){const e=await this.userModel.findById(s.admins[0]);if(!e)return t.status(404).json({message:"Admin not found",error:!0});const r=e.groups.filter((e=>e!==s._id));await this.userModel.updateOne({_id:e._id},{$set:{updatedGroups:r}}),await e.save()}const r=new d.default;await Promise.all([r.deleteAsset(s.bannerAssetId,t),r.deleteAsset(s.logoAssetId,t)]),await new a.default(this.groupModel,this.tagModel).deleteTag(s.tags,s._id),await this.groupModel.deleteOne({_id:s._id}),await u.clearCache("groups"),t.status(201).end()}catch(s){(0,i.createError)(s,e,t,"delete-group")}}async updateGroup(e,t){try{const{groupId:s,admins:r,tags:a,members:o,banner:i,description:n,logo:l,name:c,category:p,bannerAssetId:f,logoAssetId:m}=e.body,g=await this.groupModel.findById(s);if(!g)return t.status(404).json({message:"Group not found",error:!0});if(-1!==this.isAdmin(r,o))return t.status(400).json({message:"The user cannot be both a regular member and an admin simultaneously.",error:!0});const h=new d.default;f!==g.bannerAssetId&&await h.deleteAsset(g.bannerAssetId,t),m!==g.logoAssetId&&await h.deleteAsset(g.logoAssetId,t),a&&a.length>=1&&await this.createTagsForGroup(a,g.id),await this.groupModel.updateOne({_id:g._id},{banner:i,description:n,logo:l,name:c,category:p}),await u.clearCache("groups"),t.status(201).end()}catch(s){(0,i.createError)(s,e,t,"update-group")}}}},163:function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var a=Object.getOwnPropertyDescriptor(t,s);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,a)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return a(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),i(s(5142)).default.config();const d=o(s(7773)),n=i(s(1423)),u=i(s(6231)),l="log",{combine:c,timestamp:p,json:f,printf:m,prettyPrint:g,label:h,errors:y,metadata:_}=d.default.format,I=m((({timestamp:e,level:t,message:s,...r})=>`${e} ${t}: ${s} ${JSON.stringify(r,null,2)}`));t.default=class{constructor(){u.default.existsSync(l)||u.default.mkdirSync(l)}createLogger(e){return d.default.createLogger({format:c(p({format:"MMM-DD-YYYY HH:mm:ss"}),f(),h({label:e}),y(),_(),I,g()),transports:[new d.transports.Console,new d.transports.File({filename:n.default.join(l,`${e}.txt`)})]})}formatHTTPLoggerResponse=(e,t,s)=>({body:s,request:{method:e.method,url:e.url,headers:e.headers,body:e.body,params:e.params,query:e.query,clientIp:e.headers["x-forwarded-for"]??e.socket.remoteAddress},response:{statusCode:t.statusCode,headers:t.getHeaders()}})}},3586:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(s(1268)),o=r(s(7871)),i=r(s(1268)),d=s(8067),n=s(9251),u=new n.RedisService;t.default=class{meetupModel;tagModel;userModel;constructor(e,t,s){this.meetupModel=e,this.tagModel=t,this.userModel=s}async createMeetup(e,t){try{const{address:s,companyName:r,date:o,image:i,title:d,tags:n,body:l,author:c,assetId:p,category:f}=e.body,m=await this.userModel.findById(c);if(!m)return t.status(404).json({message:"User not found",error:!0});const g=await this.meetupModel.create({address:s,companyName:r,date:o,image:i,title:d,body:l,author:c,assetId:p,category:f});await new a.default(this.meetupModel,this.tagModel).createTagIfExists(n,g.id),m.meetups.push(g.id),m.points+=5,await m.save(),await u.clearCache("meetups"),t.status(201).json({data:g,error:!1}).end()}catch(s){(0,d.createError)(s,e,t,"create-meetup")}}async getAllMeetups(e,t){try{const{page:s=1,limit:r=10}=e.query,a=`meetups:${s}:limit`,o=await(new n.RedisService).getOrCacheData(a,(async()=>await this.meetupModel.find({}).populate("author","_id username profileImage createdAt").populate("tags").skip(((s?+s:1)-1)*+r).limit(+r)),t),i=await this.meetupModel.countDocuments(),d=Math.ceil(i/+r);return t.status(200).json({data:{totalPages:d,meetups:o},error:!1})}catch(s){(0,d.createError)(s,e,t,"get-all-meetup")}}async getMeetup(e,t){try{const s=await(new n.RedisService).getOrCacheData(`meetup:${e.query.id}`,(async()=>await this.meetupModel.findById(e.query.id).populate("author").populate("tags")),t);return s?t.status(200).json({data:s,error:!1}):t.status(404).json({message:"Meetup not found",error:!0})}catch(s){(0,d.createError)(s,e,t,"get-meetup")}}async deleteMeetup(e,t){try{const s=await this.meetupModel.findById(e.body.meetupId).populate("author","_id, username profileImage createdAt");if(!s)return t.status(404).json({message:"Meetup not found",error:!0});if(s.author){const r=await this.userModel.findById(s.author);if(!r)return t.status(404).json({message:"User not found",error:!0});const a=r.meetups.filter((t=>t!==e.body.meetupId));await this.userModel.updateOne({_id:r._id},{$set:{meetups:a}}),await r.save()}const r=new o.default;await r.deleteAsset(s.assetId,t),await new i.default(this.meetupModel,this.tagModel).deleteTag(s.tags,s._id),await this.meetupModel.deleteOne({_id:s._id}),await u.clearCache("meetups"),t.status(201).end()}catch(s){(0,d.createError)(s,e,t,"delete-meetup")}}async updateMeetup(e,t){try{const{meetupId:s,address:r,companyName:a,date:d,image:n,title:l,tags:c,body:p,assetId:f,category:m}=e.body,g=await this.meetupModel.findById(s);if(!g)return t.status(404).json({message:"Meetup not found",error:!0});if(c&&c.length>=1&&await new i.default(this.meetupModel,this.tagModel).createTagIfExists(c,g.id),f!==g.assetId){const e=new o.default;await e.deleteAsset(g.assetId,t)}await this.meetupModel.updateOne({_id:g._id},{address:r,body:p,category:m,companyName:a,image:n,title:l,assetId:f,date:d}),await u.clearCache("meetups"),t.status(201).end()}catch(s){(0,d.createError)(s,e,t,"update-meetup")}}}},1820:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(8067);t.default=class{messageModel;chatModel;constructor(e,t){this.messageModel=e,this.chatModel=t}async createConversation(e,t){try{const{members:s}=e.body;if(!await this.messageModel.findOne({members:{$all:s}})){const e=new this.messageModel({members:s});await e.save()}t.status(201).end()}catch(s){(0,r.createError)(s,e,t,"create-Conversation")}}async sendMessage(e,t){try{const{id:s,message:r,senderId:a,receiverId:o,media:i,messageId:d}=e.body,n=new this.chatModel({content:r,senderId:a,receiverId:o,messageId:d,...i&&{media:{...i.image&&{image:i.image?.secure_url,imageAssetId:i?.image?.public_id}}}}),u=await n.save();await this.messageModel.findOneAndUpdate({_id:s},{$push:{messages:u._id}},{new:!0}),t.status(201).end()}catch(s){(0,r.createError)(s,e,t,"send-message")}}async getAllConversation(e,t){try{const s=await this.messageModel.find({members:{$in:[e.query.members]}}).populate("members","_id, username profileImage").populate("messages");return t.json({data:s,error:!1})}catch(s){(0,r.createError)(s,e,t,"get-all-conversation")}}async getChat(e,t){try{const s=await this.messageModel.find({_id:e.query.id}).populate("members","_id, username profileImage").populate("messages");return t.json({data:s,error:!1})}catch(s){(0,r.createError)(s,e,t,"get-chat")}}async getUnreadChat(e,t){try{const{receiverId:s}=e.query,r=await this.chatModel.find({is_read:!1,receiverId:s}).populate("senderId","_id username profileImage");t.json({data:r,error:!1}).end()}catch(s){(0,r.createError)(s,e,t,"get-unread-message")}}async updateIsRead(e,t){try{const{messageId:s,senderId:r}=e.body;(await this.chatModel.find({messageId:s,senderId:r})).forEach((async e=>{await this.chatModel.findByIdAndUpdate(e._id,{is_read:!0})})),t.status(201).end()}catch(s){(0,r.createError)(s,e,t,"update-unread-message")}}}},5057:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(8067);t.default=class{notificationModel;userModel;constructor(e,t){this.notificationModel=e,this.userModel=t}async createNotification(e,t){const{to:s,from:a,message:o,type:i,postId:d,model:n,comments:u}=e.body;try{return await this.userModel.findById(s)?(await this.notificationModel.create({to:s,from:a,notificationType:i,message:o,postId:d,modelPath:n,comments:u}),t.status(200).end()):t.status(404).json({message:"User not found",error:!0})}catch(s){(0,r.createError)(s,e,t,"create-notification")}}async deleteNotification(e,t){const{type:s,postId:a,userId:o}=e.body;try{return await this.userModel.findById(o)?await this.notificationModel.find({notificationType:s,postId:a})?(await this.notificationModel.deleteOne({from:o,notificationType:s}),t.status(200).end()):t.status(404).json({message:"Notification not found"}).end():t.status(404).json({message:"User not found"}).end()}catch(s){(0,r.createError)(s,e,t,"delete-notification")}}async getAllNotification(e,t){try{const{userId:s}=e.query,r=await this.notificationModel.find({to:s,is_read:!1}).populate("from","_id username profileImage").populate({path:"postId"});return t.status(200).json({data:r,error:!1})}catch(s){(0,r.createError)(s,e,t,"get-all-notification")}}async markAllAsRead(e,t){try{const{notifications:s}=e.body;s.forEach((async e=>{const t=await this.notificationModel.findById(e);t&&await this.notificationModel.findByIdAndUpdate(t._id,{is_read:!0})})),t.status(201).end()}catch(s){(0,r.createError)(s,e,t,"mark-read-notification")}}}},8399:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(s(1268)),o=r(s(7871)),i=r(s(1268)),d=s(8067),n=s(9233),u=s(9251),l=new u.RedisService;t.default=class{podcastModel;userModel;tagModel;constructor(e,t,s){this.podcastModel=e,this.userModel=t,this.tagModel=s}async create(e,t){try{const{audio:s,audioAssetId:r,body:o,tags:i,postImage:d,title:u,author:c,postImageAssetId:p,category:f}=e.body;e.setTimeout(5e5);const m=await this.userModel.findById(c);if(!m)return t.status(404).json({message:"User not found",error:!0});const g=await this.podcastModel.create({audio:s,audioAssetId:r,body:o,postImage:d,title:u,author:c,postImageAssetId:p,category:f});return i&&i.length>=1&&await new a.default(this.podcastModel,this.tagModel).createTagIfExists(i,g.id),m.podcasts.push(g.id),m.points+=5,await Promise.all([m.save(),n.podcastQueue.add(g._id),await l.clearCache("podcasts")]),t.status(201).json({message:"Podcast has been published",error:!1})}catch(s){(0,d.createError)(s,e,t,"create-podcast")}}async getAllPodcasts(e,t){try{const{sort:s="popular",page:r=1,limit:a=10}=e.query;let o={};o="newest"===s?{createdAt:-1}:{createdAt:1};const i=`podcasts:${s}:${r}:${a}`,d=await(new u.RedisService).getOrCacheData(i,(async()=>await this.podcastModel.find().populate("author","_id username profileImage").populate("tags").skip(((r?+r:1)-1)*+a).limit(+a).sort(o)),t),n=await this.podcastModel.countDocuments(),l=Math.ceil(n/+a);t.status(200).json({error:!1,data:{allPodcasts:d,totalPages:l}}).end()}catch(s){(0,d.createError)(s,e,t,"get-all-podcast")}}async getPodcastById(e,t){try{const s=await(new u.RedisService).getOrCacheData(`podcast:${e.query.id}`,(async()=>await this.podcastModel.findById(e.query.id).populate("author")),t);return s?t.status(200).json({data:s,error:!1}):t.status(404).json({message:"Podcast not found",error:!0})}catch(s){(0,d.createError)(s,e,t,"get-podcast")}}async deletePodcast(e,t){try{const s=await this.podcastModel.findById(e.body.podcastId);if(!s)return t.status(404).json({message:"Podcast not found",error:!0});if(await l.clearCache("podcasts"),s.author){const e=await this.userModel.findById(s.author);if(!e)return t.status(404).json({message:"Author not found",error:!0});const r=e?.podcasts.filter((e=>e!==s._id)),a=new o.default;await Promise.all([this.userModel.updateOne({_id:e._id},{$set:{podcasts:r}}),e.save(),a.deleteAsset(s.audioAssetId,t),a.deleteAsset(s.postImageAssetId,t),new i.default(this.podcastModel,this.tagModel).deleteTag(s.tags,s._id),this.podcastModel.deleteOne({_id:s._id})])}t.status(201).end()}catch(s){(0,d.createError)(s,e,t,"delete-podcast")}}}},7440:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(s(1268)),o=r(s(7871)),i=s(8067),d=new(s(9251).RedisService);t.default=class{PostModel;tagModel;userModel;groupModel;constructor(e,t,s,r){this.PostModel=e,this.tagModel=t,this.userModel=s,this.groupModel=r}async createPost(e,t){const{title:s,body:r,image:o,author:n,tags:u,group:l,assetId:c,category:p}=e.body;try{const e=await this.userModel.findById(n);if(!e)return t.status(404).json({message:"User not found",error:!0}).end();const i=await this.PostModel.create({title:s,body:r,image:o,author:e,assetId:c,category:p,country:"",...l?{group:l}:{group:null}});if(e?.posts.push(i.id),e.points+=5,await(e?.save()),u&&u.length>=1&&await new a.default(this.PostModel,this.tagModel).createTagIfExists(u,i.id),l){const e=await this.groupModel.findById(l);if(!e)return t.status(404).json({message:"Group not found",error:!0});e.posts.push(i.id),await e.save()}await d.clearCache("posts"),t.status(201).json({message:"Post has been created",error:!1}).end()}catch(s){(0,i.createError)(s,e,t,"create-post")}}async getPost(e,t){try{const s=await d.getOrCacheData(`post:${e.query.id}`,(async()=>await this.PostModel.findById(e.query.id).populate("author","_id, username profileImage createdAt").populate({path:"comments",match:{parentId:{$exists:!1}},options:{sort:{createdAt:-1}},populate:{path:"author",select:{_id:1,username:1,profileImage:1}}}).populate("tags")),t);if(!s)return t.status(404).json({message:"Post not found",error:!0});t.json({data:s,error:!1}).end()}catch(s){(0,i.createError)(s,e,t,"get-post-by-id")}}async getAllPosts(e,t){try{const{sort:s="popular",page:r=1,limit:a=10}=e.query;let o={};o="newest"===s?{createdAt:-1}:{views:-1};const i=`posts:${s}:${r}:${a}`,n=await d.getOrCacheData(i,(async()=>await this.PostModel.find({group:null}).populate("author","username profileImage createdAt").populate("tags").skip((parseInt(r)-1)*parseInt(a)).limit(parseInt(a)).sort(o)),t),u=await this.PostModel.countDocuments({group:null}),l=Math.ceil(u/parseInt(a));return t.json({data:{allPosts:n,totalPages:l}})}catch(s){(0,i.createError)(s,e,t,"get-all-posts")}}async incremementView(e,t){const{postId:s}=e.body;try{if(!this.PostModel.findById(s))return t.status(404).json({message:"Post not found",error:!0});await this.PostModel.findByIdAndUpdate(s,{$inc:{views:1}}),t.status(200).end()}catch(s){(0,i.createError)(s,e,t,"increment-post")}}async likePost(e,t){const{postId:s,userId:r}=e.body;try{await d.clearCache("posts");const[e,a]=await Promise.all([this.PostModel.findById(s),this.userModel.findById(r)]);if(!a||!e)return t.status(404).json({message:"User or Post not found",error:!0});const o=e.likes.indexOf(a.id);-1!==o?e.likes.splice(o,1):e.likes.push(a.id),await e.save(),t.status(200).end()}catch(s){(0,i.createError)(s,e,t,"like-post")}}async getRelatedPosts(e,t){const{id:s,authorId:r}=e.query;try{const e=await d.getOrCacheData("related-posts",(async()=>await this.PostModel.find({author:r,group:null}).limit(4).populate("tags")),t);t.status(200).json({data:e.filter((e=>e._id.toString()!==s))}).end()}catch(s){(0,i.createError)(s,e,t,"related-post")}}async sharePost(e,t){try{const{postId:s}=e.body,r=await this.PostModel.findById(s);if(!r)return t.status(404).json({message:"Post not found",error:!0});await this.PostModel.findByIdAndUpdate(r._id,{$inc:{share:1}}),t.status(200).end()}catch(s){(0,i.createError)(s,e,t,"share-post")}}async deletePost(e,t){try{const s=await this.PostModel.findById(e.body.postId).populate("tags").populate("author","_id, username profileImage createdAt");if(!s)return t.status(404).json({error:!0,message:"Post not found"});if(s.author){let e=await this.userModel.findById(s?.author);if(!e)return t.status(404).json({message:"User not found"});const r=e.posts.filter((e=>e.toString()!==s._id.toString()));await this.userModel.updateOne({_id:e._id},{$set:{posts:r}}),await(e?.save())}const r=new o.default;await r.deleteAsset(s.assetId,t),await new a.default(this.PostModel,this.tagModel).deleteTag(s.tags,s._id),await this.PostModel.deleteOne({_id:s._id}),await d.clearCache("posts"),t.status(201).end()}catch(s){(0,i.createError)(s,e,t,"delete-post")}}async updatePost(e,t){const{postId:s,title:r,image:n,assetId:u,body:l,category:c,tags:p}=e.body;try{const e=await this.PostModel.findById(s);if(!e)return t.status(404).json({message:"Post not found",error:!0});if(p&&p.length>=1&&await new a.default(this.PostModel,this.tagModel).createTagIfExists(p,e.id),u!==e.assetId){const s=new o.default;await s.deleteAsset(e.assetId,t)}await this.PostModel.updateOne({_id:e._id},{title:r,body:l,category:c,image:n,assetId:u}),await d.clearCache("posts"),t.status(201).end()}catch(s){(0,i.createError)(s,e,t,"update-post")}}}},9251:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RedisService=void 0;const r=s(1805);t.RedisService=class{cacheExpirationTime=3600;async getOrCacheData(e,t,s){try{const s=await r.client.get(e);if(s)return s;{const s=await t();return await r.client.setex(e,this.cacheExpirationTime,s),s}}catch(e){throw console.log("Redis error",e),e}}async addData(e,t){try{await r.client.append(e,JSON.stringify(t))}catch(e){throw e}}async clearCache(e){const t=await r.client.keys(`${e}:*`);t.length&&await r.client.del(...t)}async clearCacheSingle(e){const t=await r.client.keys(e);t.length&&await r.client.del(...t)}}},1978:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(8067);t.default=class{reportModel;postModel;constructor(e,t){this.reportModel=e,this.postModel=t}async reportPost(e,t){try{const{postId:s,reasons:r,userId:a}=e.body,o=await this.postModel.findById(s);if(!o)return t.status(404).json({message:"Post not found",error:!1});const i=await this.reportModel.create({postId:o._id,reportBy:a,reasons:[...r]});o.report.push(i._id),await o.save(),t.status(201).json({message:"This post has been reported",error:!1}).end()}catch(s){(0,r.createError)(s,e,t,"report-post")}}}},2580:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(8067),a=s(9251);t.default=class{meetupModel;postModel;groupModel;podcastModel;constructor(e,t,s,r){this.meetupModel=e,this.postModel=t,this.groupModel=s,this.podcastModel=r}async search(e,t){try{const{searchTerm:s}=e.query,r=new RegExp(`^${s}`,"i"),o=await(new a.RedisService).getOrCacheData(s,(async()=>await Promise.all([this.meetupModel.find({$text:{$search:r,$caseSensitive:!1}}),this.groupModel.find({$text:{$search:r,$caseSensitive:!1}}),this.postModel.find({$text:{$search:r,$caseSensitive:!1}}),this.podcastModel.find({$text:{$search:r,$caseSensitive:!1}})])),t);t.status(200).json({data:{meetups:o[0],groups:o[1],post:o[2],podcasts:o[3]}}).end()}catch(s){(0,r.createError)(s,e,t,"search")}}}},1268:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(9251);t.default=class{model;tagModel;constructor(e,t){this.model=e,this.tagModel=t}async createTagIfExists(e,t){try{const s=new Set;if(this.tagModel&&this.model){for(const r of[...new Set(e)]){const[e]=await Promise.all([this.tagModel.findOneAndUpdate({name:r},{$setOnInsert:{name:r},$push:{postIds:t}},{upsert:!0,new:!0})]);s.add(e._id)}return await this.model.findByIdAndUpdate(t,{tags:[...s]}),[...s]}}catch(e){throw e}}async getAllTags(e){try{if(this.tagModel){const t=await(new r.RedisService).getOrCacheData("tags",(async()=>await this.tagModel.find().sort({postIds:-1}).limit(5)),e);return e.json({data:t,error:!1})}}catch(t){return e.status(500).json({error:t})}}async deleteTag(e,t){try{e.forEach((async e=>{let s=await this.tagModel.findById(e._id);if(s)if(1===s.postIds.length)await this.tagModel.deleteOne({name:s.name});else{let e=s.postIds.filter((e=>e.toString()!==t.toString()));s.postIds=e,await s.save()}}))}catch(e){throw e}}}},6717:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(s(7096)),o=s(8067);t.default=class{userModel;constructor(e){this.userModel=e}async createUser(e,t){try{const{email:s,id:r,image:o,password:i,username:d}=e.body;a.default.hash(i,10,(async(e,a)=>e?t.status(400).json({message:"Failed to hash password",error:!0}):(await this.userModel.create({email:s,...o&&{profileImage:o},_id:r,password:a,username:d}),t.status(201).json({message:"User created",error:!1}).end())))}catch(s){(0,o.createError)(s,e,t,"create-user")}}async getUser(e,t){try{const s=await this.userModel.findById(e.query.id).populate({path:"posts",populate:[{path:"author"},{path:"tags"}]}).populate("groups").populate("meetups").populate({path:"podcasts",populate:{path:"author"}});if(!s)return t.status(404).json({message:"User not found",error:!0});t.json({data:s,error:!1}).end()}catch(s){(0,o.createError)(s,e,t,"get-user")}}async updateGroupFields(e,t,s){try{const r=await this.userModel.findById(e);if(!r)throw new Error("User not found");r[t].push(s),await r.save()}catch(e){throw e}}async handleFollow(e,t){try{const{userId:s,followerId:r}=e.body,a=await this.userModel.findById(s);let o=await this.userModel.findById(r);if(!a||!o)return t.status(404).json({message:"User not found",error:!1});const i=a.followers.indexOf(r);-1===i?(a.followers.push(r),o.followings.push(a._id)):(a.followers.splice(i,1),o.followings=o.followings.filter((e=>e!==a._id.toString()))),await Promise.all([a.save(),o.save()]),t.status(200).end()}catch(s){(0,o.createError)(s,e,t,"follow-user")}}async getAllUsers(e,t){try{const s=await this.userModel.find({_id:{$ne:e.query.userId}}).select("_id username profileImage createdAt");return t.json({data:s,error:!1})}catch(s){(0,o.createError)(s,e,t,"get-all-user")}}}},8067:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createError=void 0;const a=new(r(s(163)).default);t.createError=function(e,t,s,r){const o=a.formatHTTPLoggerResponse(t,s,{error:e});a.createLogger(r).error("Error Message",o,{error:e}),e instanceof Error?s.status(500).json({message:e.message,error:!0}).end():s.status(500).json({message:"An unknown error occurred",error:!0}).end()}},7096:e=>{e.exports=require("bcrypt")},7068:e=>{e.exports=require("bull")},3518:e=>{e.exports=require("cloudinary")},7455:e=>{e.exports=require("compression")},3582:e=>{e.exports=require("cors")},4347:e=>{e.exports=require("crypto")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},6231:e=>{e.exports=require("fs")},7806:e=>{e.exports=require("helmet")},1185:e=>{e.exports=require("mongoose")},1738:e=>{e.exports=require("multer")},1423:e=>{e.exports=require("path")},7773:e=>{e.exports=require("winston")}},i={};function d(e){var t=i[e];if(void 0!==t)return t.exports;var s=i[e]={exports:{}};return o[e].call(s.exports,s,s.exports,d),s.exports}d.m=o,d.x=()=>{var e=d.O(void 0,[902],(()=>d(3607)));return d.O(e)},e=[],d.O=(t,s,r,a)=>{if(!s){var o=1/0;for(l=0;l<e.length;l++){for(var[s,r,a]=e[l],i=!0,n=0;n<s.length;n++)(!1&a||o>=a)&&Object.keys(d.O).every((e=>d.O[e](s[n])))?s.splice(n--,1):(i=!1,a<o&&(o=a));if(i){e.splice(l--,1);var u=r();void 0!==u&&(t=u)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[s,r,a]},s=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,d.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var a=Object.create(null);d.r(a);var o={};t=t||[null,s({}),s([]),s(s)];for(var i=2&r&&e;"object"==typeof i&&!~t.indexOf(i);i=s(i))Object.getOwnPropertyNames(i).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,d.d(a,o),a},d.d=(e,t)=>{for(var s in t)d.o(t,s)&&!d.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},d.f={},d.e=e=>Promise.all(Object.keys(d.f).reduce(((t,s)=>(d.f[s](e,t),t)),[])),d.u=e=>e+".bundle.js",d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a={179:1},d.O.require=e=>a[e],d.f.require=(e,t)=>{a[e]||(e=>{var t=e.modules,s=e.ids,r=e.runtime;for(var o in t)d.o(t,o)&&(d.m[o]=t[o]);r&&r(d);for(var i=0;i<s.length;i++)a[s[i]]=1;d.O()})(require("./"+d.u(e)))},r=d.x,d.x=()=>(d.e(902),r());var n=d.x(),u=exports;for(var l in n)u[l]=n[l];n.__esModule&&Object.defineProperty(u,"__esModule",{value:!0})})();